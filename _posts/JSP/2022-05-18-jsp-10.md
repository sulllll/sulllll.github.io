---
layout: single
title:  " DAY-54 JSP - ê²Œì‹œê¸€ê´€ë¦¬ / ajax"
categories: JSP
tag: [JSP, ê²Œì‹œê¸€ ê´€ë¦¬, ajax]
toc: true
toc_sticky: true
author_profile: false
sidebar:
  nav: "docs"
---



# ğŸ˜º 2022-05-18 / JSP

<!--Quote-->
> â— ìˆ˜ì—…ì„ ë“£ê³ , ê°œì¸ì´ ê³µë¶€í•œ ë‚´ìš©ì„ ì ì€ ê²ƒ ì´ê¸°ì— ì˜¤ë¥˜ê°€ ë§ì„ ìˆ˜ë„ ìˆìŒ



# ğŸ”” ê³µë¶€ ì½”ë“œ

## 1ï¸âƒ£ ê²Œì‹œíŒ ê¸€ ìˆ˜ì •

1) detailView.jsp

```java
<div class="row">
 <div class="col d-flex justify-content-center">
   <button type="button" class="btn btn-secondary" id="btnBack">ë’¤ë¡œê°€ê¸°</button>
   <c:if test="${loginSession.id eq dto.writer_id}">
   <button type="button" class="btn btn-warning" id="btnModify">ìˆ˜ì •</button>
   <button type="button" class="btn btn-danger" id="btnDelete">ì‚­ì œ</button>

   <script>
     $("#btnModify").on("click",function(){
      location.href = "/modify.bo?seq_board=${dto.seq_board}";  /* seq_boardë¥¼ getë°©ì‹ìœ¼ë¡œ ë„˜ê²¨ì¤€ë‹¤ */
     })
    </script>
   </c:if>
</div>
```

- <c:if test="${loginSession.id eq dto.writer_id}">ëŠ” <!-- í˜„ì¬ ì ‘ì†í•´ìˆëŠ” ì„¸ì…˜ì˜ idê°€ ê¸€ì„ ì‘ì„±í•œ ì‚¬ëŒì˜ idì™€ ê°™ë‹¤ë©´ --> ìˆ˜ì •ê³¼ ì‚­ì œ ë²„íŠ¼ì„ ë³´ì´ê²Œ í•œë‹¤
- ìˆ˜ì •ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ get ë°©ì‹ìœ¼ë¡œ í•´ë‹¹ seq_board(ê¸€ë²ˆí˜¸)ë¥¼ ë„˜ê²¨ì¤€ë‹¤

2) BoardController

```java
else if(uri.equals("/modify.bo")) { // 5ë²ˆ ê²Œì‹œê¸€ ì œëª© í´ë¦­í›„ -> ê²Œì‹œê¸€ ìˆ˜ì • ë²„íŠ¼ ëˆŒë €ì„ ë•Œ
	int seq_board = Integer.parseInt(request.getParameter("seq_board"));
	System.out.println("modify.bo / seq_board : " + seq_board );
	BoardDAO dao = new BoardDAO();

	try {
		BoardDTO dto = dao.modifySelectAll(seq_board);
		if(dto != null) {
			request.setAttribute("dto", dto);
			request.getRequestDispatcher("/board/modify.jsp").forward(request, response);
		}

	} catch (Exception e) {
		e.printStackTrace();
	}
}
```

- ìˆ˜ì •ë²„íŠ¼ì„ í†µí•´ get ë°©ì‹ìœ¼ë¡œ ë„˜ì–´ì˜¨ seq_board ê°’ì„ intí˜•ìœ¼ë¡œ ë³€í™˜í•´ì„œ ë°›ì•„ì¤€ë‹¤
- tryì•ˆì—ì„œ ë°›ì•„ì˜¨ seq_boardë¥¼ ì¸ìê°’ìœ¼ë¡œ í•˜ëŠ” ë°ì´í„°ë¥¼ ì¶œë ¥í•˜ëŠ” ë©”ì„œë“œë¥¼ daoì—ì„œ ìƒì„±í›„ modify.jspì—ê²Œ ë³´ë‚´ì¤€ë‹¤

3) modify.jsp

```java
<form id="modifyForm" action="/modifyProc.bo?seq_board=${dto.seq_board}" method="post">
	 <div class="container">
	  <div class="row">
	   <div class="col-2 d-flex justify-content-center align-items-center">
	    <h4>ì œëª©</h4>
	   </div>
	   <div class="col-10 p-2">
	    <input type="text" class="form-control" id="title" name="title" value="${dto.getTitle() }">
	   </div>
	  </div>
	  <div class="row">
	   <div class="col-2 d-flex justify-content-center align-items-center">
	    <h4>ë‚´ìš©</h4>
	   </div>
	   <div class="col-10 p-2">
	    <textarea id="content" class="form-control" id="content" name="content">${dto.getContent()}</textarea>
	   </div>
	  </div>
	 </div>
 </form>
<div class="boxBtn">
     <button type="button" class="btn btn-secondary" id="btnBack">ë’¤ë¡œê°€ê¸°</button>
     <button type="button" class="btn btn-primary" id="btnModify">ìˆ˜ì •</button>
 </div>

```

- BoardControllerì—ì„œ ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ inputì˜ valueê°’, textareaì˜ htmlê°’ìœ¼ë¡œ ì‘ì„±í•´ë‘”ë‹¤.
- ê·¸ í›„ ìˆ˜ì • ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ formíƒœê·¸ì˜ actionëŒ€ë¡œ getë°©ì‹ì„ í†µí•´ ë³€ê²½ëœ ë°ì´í„°ì¸ titleê³¼ contentë¥¼ BoardControllerì—ê²Œ ë³´ë‚´ì¤€ë‹¤

4) BoardController

```java
else if(uri.equals("/modifyProc.bo")) {

	BoardDAO dao = new BoardDAO();
	int seq_board = Integer.parseInt(request.getParameter("seq_board"));
	String title = request.getParameter("title");
	String content = request.getParameter("content");

	try {
		int rs = dao.modifyBySeq(seq_board, title, content);
		if(rs > 0) {
			System.out.println("ê²Œì‹œê¸€ ìˆ˜ì • ì„±ê³µ");
			response.sendRedirect("/board.bo");
		}
	} catch (Exception e) {
		e.printStackTrace();
	}
}
```

- modify.jspì—ì„œ getì„ í†µí•´ ë„˜ì–´ì˜¨ seq_boardì™€ title , contentë¥¼ ì¸ìë¡œ í•˜ëŠ” ë©”ì„œë“œë¥¼ ìƒì„±í•´ sqlë¬¸ì„ ì‹¤í–‰í•˜ê³  ë‹¤ì‹œ ëª¨ë“  ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ë¥¼ ë³´ì—¬ì£¼ëŠ” /board.boë¥¼ ë³´ì—¬ì¤€ë‹¤

ê°•ì‚¬ë‹˜ì˜ modify.jsp (ë‚˜ì˜ 3ë²ˆê³¼ ë¹„êµ)

```java
<form id="modifyForm" action="/modifyProc.bo" method="post">
	    <div class="container">
	    	<div class="row">
	    		<div class="col-2 d-flex justify-content-center align-items-center">
	    			<h4>ì œëª©</h4>
	    		</div>
	    		<div class="col-10 p-2">
	    			<input type="text" class="form-control" id="title" name="title" value="${dto.getTitle() }">
	    		</div>
	    		<div class="col-10 p-2">
	    			<input type="text" class="form-control d-none" id="sec_Board" name="seq_board" value="${dto.getSeq_board()}">
	    		</div>
	    	</div>
	    	<div class="row">
	    		<div class="col-2 d-flex justify-content-center align-items-center">
	    			<h4>ë‚´ìš©</h4>
	    		</div>
	    		<div class="col-10 p-2">
	    			<textarea id="content" class="form-control" id="content" name="content">${dto.getContent()}</textarea>
	    		</div>
	    	</div>
	    </div>
    </form>
```

â— ê°•ì‚¬ë‹˜ê³¼ ê°™ì€ê²½ìš° inputì„ ì•ˆë³´ì´ê²Œ í•œë‹¤ìŒì— formìœ¼ë¡œ ë„˜ê²¨ì¤¬ë‹¤ ì¦‰ postë°©ì‹ì´ìš©

â— ë‚˜ê°™ì€ê²½ìš° form íƒœê·¸ì•ˆì— getë°©ì‹ìœ¼ë¡œ ë„˜ê²¨ì¤¬ë‹¤ ë‚˜ëŠ” getë°©ì‹ ì´ìš©

ğŸ’¡ ìˆ˜ì •ì´ê¸° ë•Œë¬¸ì— postë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë‚«ë‹¤.

## 2ï¸âƒ£ ê²Œì‹œíŒ ê²€ìƒ‰(ì œëª©ìœ¼ë¡œ)

1) board.jsp

```java
// ê²€ìƒ‰ ë²„íŠ¼ ëˆŒë €ì„ ë•Œ
   $("#searchBtn").on("click",function(){
    let searchKeyword = $("#searchKeyword").val();
    console.log(searchKeyword);
    location.href = "/searchProc.bo?searchKeyword="+searchKeyword; // getìœ¼ë¡œ ë³´ë‚´ê¸°
   })
```

- getë°©ì‹ìœ¼ë¡œ searchKeywordì˜ ê°’ì„ ë³´ë‚¸ë‹¤

2) BoardController

```java
else if(uri.equals("/searchProc.bo")) { // í•´ë‹¹ í‚¤ì›Œë“œë¥¼ ê²€ìƒ‰í•´ì„œ í™”ë©´ì— ë¿Œë ¤ì£¼ê¸°
	String searchKeyword = request.getParameter("searchKeyword");
	BoardDAO dao = new BoardDAO();
	try {
		ArrayList<BoardDTO> list = dao.searchByTitle(searchKeyword);
		request.setAttribute("list", list);
		request.getRequestDispatcher("/board/board.jsp").forward(request, response);
	} catch (Exception e) {
		e.printStackTrace();
	}
}
```

- board.jsp ì—ì„œ searchKeywordë¥¼ ë°›ì•„ì™€ searchByTitleì˜ ì¸ìë¡œ í™œìš©í•œë‹¤
- ì—¬ê¸°ì„œ /board.boë¡œ ë³´ë‚´ë©´ /board.boì—ì„œëŠ” ê¸°ì¡´ì˜ ì „ì²´ listë§Œ ë°›ì•„ì˜¨ë‹¤ (ê²€ìƒ‰í•´ì„œ ë‚˜ì˜¨ ê¸€ì˜ ë°ì´í„°ê°€ì•„ë‹Œ)

3) board.jsp

```java
<c:choose>
	<c:when test="${list.size() == 0}">
		<tr>
			<td colspan=5>ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td>
		</tr>
	</c:when>
	<c:otherwise>
		<c:forEach items="${list}" var="dto">
			<tr>
				<td>${dto.seq_board}</td>
				<td><a href="/detailView.bo?seq_board=${dto.seq_board}">${dto.title}</a></td>
				<td>${dto.writer_nickname}</td>
				<td>${dto.written_date}</td>
				<td>${dto.view_count}</td>
			</tr>
		</c:forEach>
	</c:otherwise>
</c:choose>
```

- ë°˜ë³µë¬¸ì„ í†µí•´ ê²€ìƒ‰ í‚¤ì›Œë“œì— ë„ì¶œëœ ë°ì´í„°(ê°ì²´)ë¥¼ í™”ë©´ì— ë³´ì—¬ì¤€ë‹¤

## 3ï¸âƒ£ ê²Œì‹œê¸€ ì‚­ì œ

1) detailView.jsp

```java
$("#btnDelete").on("click",function(){
	let answer = confirm("ì§€ê¸ˆ ì‚­ì œí•˜ì‹œë©´ ë³µêµ¬ê°€ ë¶ˆê°€í•©ë‹ˆë‹¤. ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
	console.log(answer); // confirmì€ true / falseë¡œ ê°’ì´ ë„ì¶œëœë‹¤.
	if(answer) { // answerì˜ ê°’ì´ trueì´ë©´
		location.href = "/deleteProc.bo?seq_board=${dto.seq_board}"; // ì‹œí€€ìŠ¤ ë²ˆí˜¸ë„ ê°™ì´ ë³´ë‚´ì¤€ë‹¤
	}

})
```

- í•´ë‹¹ ê¸€ ë²ˆí˜¸ë¥¼ getë°©ì‹ìœ¼ë¡œ ë³´ë‚¸ë‹¤

2) BoardController



```java
else if(uri.equals("/deleteProc.bo")) { // ì‹œí€€ìŠ¤ë²ˆí˜¸ ì´ìš©í•´ tbl_boardì—ì„œ ê²Œì‹œê¸€ ì‚­ì œ
	int seq_board = Integer.parseInt(request.getParameter("seq_board"));

	BoardDAO dao = new BoardDAO();
	try {
		int rs= dao.deleteBySeq(seq_board);
		if(rs > 0) {
			System.out.println("ê²Œì‹œê¸€ ì‚­ì œ ì™„ë£Œ");
			response.sendRedirect("/board.do");
		}
	} catch (Exception e) {
		System.out.println("ê²Œì‹œê¸€ ì‚­ì œ ì‹¤íŒ¨");
		e.printStackTrace();
	}
}
```

- detailView.jspì—ì„œ ë³´ë‚¸ seq_boardë¥¼ ì¸ìë¡œ í•˜ëŠ” deleteBySeqë©”ì„œë“œë¥¼ ì‹¤í–‰í•œë‹¤.

## 4ï¸âƒ£ Ajax

ajax : ë¹„ë™ê¸° í†µì‹ í• ë•Œ ì‚¬ìš©í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ (ì „ì²´ í˜ì´ì§€ì˜ ë¦¬ë¡œë“œì—†ì´ ë¶€ë¶„ì ì¸ í˜ì´ì§€ë§Œ ì„œë²„ì™€ í†µì‹ í•˜ì—¬ ë¦¬ë¡œë“œí•  ìˆ˜ ìˆëŠ” ê²ƒ)

```javascript
<button type="button" class="btn btn-secondary" id="btnLogout">ë¡œê·¸ì•„ì›ƒ</button>
<button type="button" class="btn btn-success" id="toInput">ìš”ì²­ë³´ë‚´ê¸°</button>

<form id="testForm">
	<input type="text" name = "id">
	<input type="text" name = "nickname">
	<button type="button" class="btn btn-success" id=btnSumbit>ì œì¶œ</button>
</form>


<script>
	// post ë°©ì‹
	$("#btnSumbit").on("click",function(){
		// postë°©ì‹ìœ¼ë¡œ ë¹„ë™ê¸°í†µì‹  ë°ì´í„° ì „ì†¡
		// formíƒœê·¸ ì•ˆì˜ ë°ì´í„°ë¥¼ ê°ì²´ í˜•ì‹ì„ ë³€í™˜ì‹œì¼œì£¼ëŠ” í•¨ìˆ˜

		let data = $("#testForm").serialize();
		console.log(data);

		$.ajax({
			url : "/sendForm.test",
			type : "post",
			data : data,
			success : function() {},
			error : function(e) {
				console.log(e);
			}
		})
	})

	// getë°©ì‹
	$("#toInput").on("click",function(){

		// 1.ìš”ì²­ ë³´ë‚´ê¸°
		$.ajax({
			url: "/sendMsg.test?msg=HelloWorld",
			type : "get", // getë°©ì‹
			success : function() {},
			error : function(e) {
				console.log(e);
			}
		});
	})
</script>
```

- postë°©ì‹ì€ serialize()ë¥¼ í†µí•´ dataë¥¼ ì „ì†¡í•œë‹¤

2)

```java
// response.getWriter().append(ë³´ë‚¼ê°’)
response.getWriter().append("Hello World");
```

### ì˜ˆì‹œ 1) ì¼ë°˜ ë°ì´í„°

test.jsp

```javascript
$("#getData").on("click",function(){ // ìš”ì²­ì— ë”°ë¼ í…ìŠ¤íŠ¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
	$.ajax({
		url : "/getData.test?msg=goodbye", // ì´ë ‡ê²Œ urlì„ ë³´ëƒ„
		type : "get", // ë³´ë‚¼ ë°ì´í„° íƒ€ì…
		dataType : "text", // ë°›ì•„ì˜¬ ë°ì´í„°ì˜ íƒ€ì…
		success : function(data){
			console.log(data); // consoleì— ë°›ì•„ì˜¨ dataë¥¼ ë³´ì—¬ì¤Œ
		},
		error : function() {
			console.log(e);
		}
	})
})
```

TestController

```java
else if(uri.equals("/getData.test")) {
		System.out.println("ë°ì´í„° ìš”ì²­");
		String msg = request.getParameter("msg"); // goodbyeë¥¼ ë°›ìŒ
		System.out.println("msg : " + msg);
		// ajaxë¡œ í†µì‹ í• ë•Œ ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê³  ì‹¶ë‹¤ë©´
		// response.getWriter().append(ë³´ë‚¼ê°’)
		// response.getWriter().append("Hello World");

		if(msg.equals("hello")) {
			response.getWriter().append("Hello world from controller"); // Hello world from controllerë¥¼ testë¡œ ë³´ëƒ„
		}else if(msg.equals("goodbye")){
			response.getWriter().append("goodbye from controller"); // goodbye from controllerë¥¼ testë¡œ ë³´ëƒ„
		}
	}
```

### ì˜ˆì‹œ 2) jsonì‚¬ìš©

test.jsp

```javascript
$("#getDTO").on("click",function(){
	$.ajax({
		url : "/getDTO.test",
		type : "get",
		dataType : "json", // success ì•ˆìª½ì—ì„œ jsì˜ ê°ì²´ ì²˜ëŸ¼ ë‹¤ë£¨ê³  ì‹¶ìœ¼ë©´ dataTypeì„ jsonìœ¼ë¡œ í•´ì¤€ë‹¤
		success : function(data) {
			console.log(data);
			console.log(data.seq_board);
			console.log(data.writer_nickname);
		},
		error : function(e){
			console.log(e);
		}

	})
})
```

TestController

```java
else if(uri.equals("/getDTO.test")) {
	System.out.println("DTO ë°ì´í„° ìš”ì²­");
	BoardDAO dao = new BoardDAO();
	try {
		BoardDTO dto = dao.selectBySeq(3);

		// gson ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© -> ê°ì²´ë‚˜ ê°ì²´ë°°ì—´ì„ ajax, json íƒ€ì…ìœ¼ë¡œ ì „ì†¡í•˜ê¸° ìœ„í•´
		Gson gson = new Gson();
		String rs = gson.toJson(dto); // json í˜•ì‹ìœ¼ë¡œ dtoë¥¼ ë³€í™˜í•˜ê³  ê·¸ê²ƒì„ Stringì„ ë³€í™˜

		response.getWriter().append(rs);
	} catch (Exception e) {
		// TODO Auto-generated catch block
		e.printStackTrace();
	}
}
```

- gson ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤