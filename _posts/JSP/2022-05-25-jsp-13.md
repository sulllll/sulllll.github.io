---
layout: single
title:  " DAY-59 JSP - ê²Œì‹œíŒ íŒŒì¼ ë‹¤ìš´ë¡œë“œ"
categories: JSP
tag: [JSP, ê²Œì‹œíŒ íŒŒì¼ ë‹¤ìš´ë¡œë“œ]
toc: true
toc_sticky: true
author_profile: false
sidebar:
  nav: "docs"
---



# ğŸ˜º 2022-05-25 / JSP

<!--Quote-->
> â— ìˆ˜ì—…ì„ ë“£ê³ , ê°œì¸ì´ ê³µë¶€í•œ ë‚´ìš©ì„ ì ì€ ê²ƒ ì´ê¸°ì— ì˜¤ë¥˜ê°€ ë§ì„ ìˆ˜ë„ ìˆìŒ

## ğŸ””tbl_fileì— ë°ì´í„° ë„£ê¸°

### DB ì»¬ëŸ¼

1. seq_title(ì‹œí€€ìŠ¤)
2. seq_board(ê²Œì‹œê¸€ ë²ˆí˜¸)
3. ori_name(íŒŒì¼ ì›ë³¸ ì´ë¦„)
4. sys_name(í´ë”ì— ì˜¬ë¼ê°ˆ íŒŒì¼ì´ë¦„)


**boardDAO**

```java
// íŒŒì¼ í…Œì´ë¸”ì— ë„£ê¸° ìœ„í•œ ë©”ì„œë“œ
public int getNewSeq() throws Exception {
	String sql = "select seq_board.nextval from dual";

	try(Connection con = bds.getConnection();
		PreparedStatement pstmt = con.prepareStatement(sql)) {

		ResultSet rs = pstmt.executeQuery();
		rs.next();
		int seq_board = rs.getInt(1);
		return seq_board;
	}
}
```

**boardController**

```java
try{
	FileDAO daoFile = new FileDAO();

	// íŒŒì¼ í…Œì´ë¸”ì— ë„£ê¸° ìœ„í•œ ì‘ì—… boardDAOì—ì„œ seq_boardë¥¼ ì–»ì–´ì˜¤ëŠ” ì‘ì—…ì„ í•´ì¤˜ì•¼í•œë‹¤
	int seq_board = dao.getNewSeq();
	System.out.println("seq_board : + " + seq_board);

	int rs = dao.write(new BoardDTO(seq_board,title,content,writer_nickname,writer_id,0,null));
	int rsFile = daoFile.insert(new FileDTO(0, seq_board,ori_name,sys_name));
	if(rs > 0 && rsFile > 0) {
		response.sendRedirect("/board.bo?curPage=1");
	}
		}catch(Exception e) {
	e.printStackTrace();
}
```

- íŒŒì¼ì„ ì˜¬ë¦´ í•´ë‹¹ í…Œì´ë¸”ì˜ seq_boardë¥¼ ì–»ì–´ì˜¤ëŠ” ë°©ë²•ì€ boardDAOì—ì„œ "select seq_board.nextval from dual"; ë¥¼ í†µí•´ ì–»ì–´ì˜¨ë‹¤
- tbl_file ì—ë„ seq_boardë¥¼ ë„£ì–´ì„œ tbl_boardë¥¼ í†µí•´ ì–»ì–´ì˜¨ seq_boardë¥¼ tbl_fileì— í™œìš© í•  ìˆ˜ìˆê²Œ dbì„¤ê³„ â†’ í•´ë‹¹ ê¸€ì— ë§ëŠ” í•´ë‹¹ íŒŒì¼ê³¼ íŒŒì¼ì´ë¦„ì„ ë§Œë“¤ê¸° ìœ„í•´ì„œ

## ğŸ”” ê²Œì‹œê¸€ì˜ ì²¨ë¶€íŒŒì¼ ë‹¤ìš´ë¡œë“œ ë°›ê¸°

1. boardDetail.jsp íŒŒì¼ì—ì„œ í•´ë‹¹ ê²Œì‹œë¬¼ì˜ ì²¨ë¶€íŒŒì¼ì¸ ì›ë³¸íŒŒì¼ì˜ ì´ë¦„ì„ BoardControllerì—ì„œ ë°›ì•„ì™€ì•¼í•œë‹¤ â†’ BoardControllerì—ì„œ ì›ë³¸íŒŒì¼ì˜ ì´ë¦„ì„ ì–»ê¸° ìœ„í•´ì„  í•´ë‹¹ ê²Œì‹œë¬¼ì˜ ë²ˆí˜¸ì¸ seq_boardë¥¼ ì•Œì•„ì•¼í•œë‹¤.
2. BoardControllerì—ì„œ seq_boardë¥¼ ì¸ìë¡œí•´ FileDAOì—ì„œ  tbl_fileì˜ ê°ì²´ê°’ì„ ë°˜í™˜ë°›ê³  ë‹¤ì‹œ boardDetail.jspì— ì „ì†¡í•´ì¤€ë‹¤
3. BoardControllerì—ì„œ ë°›ì€ ê°ì²´ê°’ì¤‘ ori_nameì„ ë²„íŠ¼ì˜ ê°’ìœ¼ë¡œ, ë˜ inputì€ display-noneì„ í•´ì¤€ ìƒíƒœë¡œ nameê³¼ valueë¡œ ê°’ì„ ë„£ì–´ì¤€ë‹¤
4. ë²„íŠ¼ í´ë¦­ìŠ¤ í•´ë‹¹ ì²¨ë¶€íŒŒì¼ì„ ë‹¤ìš´ ë°›ì„ ìˆ˜ìˆëŠ” FileControllerì—ê²Œ ori_nameì„ Formìœ¼ë¡œ ì „ì†¡í•˜ì—¬ FileControllerì—ì„œ ì‚¬ìš©ìê°€ ì„ íƒí•œ íŒŒì¼ì„ ë‹¤ìš´ë°›ì„ ìˆ˜ ìˆê²Œí•œë‹¤

**boardDetail.jsp**

```java
// detailView.jspì—ì„œ ê°€ì§€ê³ ìˆëŠ” seq_boardë¥¼ ê°€ì ¸ì˜´
int seq_board = Integer.parseInt(request.getParameter("seq_board"));
System.out.println("seq_board : " + seq_board);
BoardDAO boardDAO = new BoardDAO();
FileDAO daoFile = new FileDAO();

try {
	// íŒŒì¼ í…Œì´ë¸”ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° :
	FileDTO dtoFile = daoFile.selectBySeqBoard(seq_board);
	request.setAttribute("dtoFile", dtoFile); // dtoFile ê°ì²´ë¥¼ /board/detailView.jspì—ê²Œ ë¿Œë ¤ì¤Œ

}catch(Exception e) {
	e.printStackTrace();
}
request.getRequestDispatcher("/board/detailView.jsp").forward(request, response);

```

**FileController**

```java
else if(uri.equals("/download.file")) { // ë‹¤ìš´ë¡œë“œ ìš”ì²­
	System.out.println("ë‹¤ìš´ë¡œë“œ ìš”ì²­!");

	// detailViewì—ì„œ ë³´ë‚¸ ori_name ê°’(íŒŒì¼ëª…)ì„ ë°›ì•„ì˜¨ë‹¤
	String dto_ori_name = request.getParameter("ori_name");
	System.out.println(dto_ori_name);

	String fileName = dto_ori_name; // ì„œë²„ì— ì‹¤ì œ ì €ì¥ë˜ì–´ ìˆëŠ” íŒŒì¼ëª…

	// í•´ë‹¹ í´ë”ì˜ ê²½ë¡œ
	String uploadFilePath = request.getServletContext().getRealPath("file");
	System.out.println("uploadFilePath : " + uploadFilePath);

	// í•´ë‹¹ í´ë”ì˜ í•´ë‹¹ íŒŒì¼ ê²½ë¡œ
	// File.separatorë¥¼ ì“°ëŠ”ì´ìœ  -> ë‹¨ìˆœíˆ / ë§Œ ì“°ë©´ ìš´ì˜ì²´ì œì— ë”°ë¼ì„œ í‘œê¸°í•˜ëŠ” ë²•ì´ ë‹¤ ë‹¤ë¥´ê¸°ë•Œë¬¸ì—
	String filePath = uploadFilePath + File.separator +fileName;
	System.out.println("filePath : " + filePath);

	// ì•„ë˜ì—ì„œ ì‹¤ì œ íŒŒì¼ì„ ì½ì–´ë“¤ì—¬ì˜¬ë•Œ íŒŒì¼ì˜ í­ê¸°ë°§ì„ í™œìš©í•˜ê¸° ìœ„í•´ file ê°ì²´ ìƒì„±
	File file = new File(filePath);

	// responseì˜ header ì„¤ì • -> ì§€ê¸ˆ ëŒì•„ê°€ëŠ” ì‘ë‹µê°’ì´ ì¼ë°˜ì ì¸ htmlì´ ì•„ë‹ˆë¼ ë‹¤ìš´ë¡œë“œê°€ ì´ë¤„ì¤˜ì•¼ í•˜ëŠ” íŒŒì¼ì´ë¼ëŠ” ê²ƒì„ ì•”ì‹œ
	// íŒŒì¼ì„ ë‹¨ìˆœíˆ ë³´ì—¬ì£¼ëŠ”ê²ƒì´ ì•„ë‹Œ ë‹¤ìš´ ë°›ì•„ì•¼í•˜ëŠ” ìƒí™©
	String ori_name = dto_ori_name; // íŒŒì¼ì˜ ì›ë³¸íŒŒì¼ëª…(íŒŒì¼ í…Œì´ë¸”ì´ ìˆë‹¤ë©´ ê±°ê¸°ì„œ ì–»ì–´ì˜¨ ê°’) ë‹¤ìš´ë¡œë“œ ë°›ì„ ë•Œ ì´ë¦„

	// íŒŒì¼ëª… í•œê¸€ê¹¨ì§ ë°©ì§€
	ori_name = new String(ori_name.getBytes("utf-8"),"ISO-8859-1");

	response.setHeader("Content-disposition", "attachment; filename=\""+ori_name+"\"");

	// filename = "45.jpg" ì´ì™€ ê°™ì´ ìƒê¸´ ë¬¸ìì—´ ë§Œë“¤ì–´ì„œ filename ì†ì„±ì— ê°’ìœ¼ë¡œ ë„£ì–´ì£¼ê¸°

	// ì„œë²„ì˜ HDDì— ìˆëŠ” íŒŒì¼ì„ ì„œë²„ í”„ë¡œê·¸ë¨ìœ¼ë¡œ ì½ì–´ë“¤ì—¬ì˜¤ê³ 
	// í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ê·¸ íŒŒì¼ì„ ì‘ë‹µ
	try(DataInputStream dis = new DataInputStream(new FileInputStream(filePath));
		DataOutputStream dos = new DataOutputStream(response.getOutputStream())) {

		// ë¹„ì–´ìˆëŠ” byte ë°°ì—´ í•˜ë‚˜ ë§Œë“¤ì–´ ê·¸ ë°°ì—´ì•ˆ ë°ì´í„°ë¥¼ í•œë²ˆì— ë¶ˆëŸ¬ë“¤ì¼ ê²ƒ.
		byte[] arr = new byte[(int)file.length()];
		// datainputstreamì„ ì´ìš©í•´ ë¹„ì–´ìˆëŠ” ë°°ì—´ì˜ íŒŒì¼ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ ë‹´ìŒ
		dis.readFully(arr);

		dos.write(arr);
		dos.flush();
	}catch(Exception e) {
		e.printStackTrace();
	}

}
```

## ğŸ”” ê¹ƒ ì‚¬ìš©

ê¹ƒ ì»¤ë°‹

- git add

ê¹ƒ ìƒíƒœ í™•ì¸(ì»¤ë°‹ í–ˆë‚˜ ì•ˆí–ˆë‚˜)

- git status

ê¹ƒ ë©”ì„¸ì§€ ë‚¨ê¸°ê¸°

- git commit -m "ë©”ì„¸ì§€ ë‚´ìš©"

ê¹ƒ ë˜ëŒë¦¬ê¸°(íŠ¹ì • ì‹œì )

- git checkout (gitlog ì•ìë¦¬ë²ˆí˜¸)

ê¹ƒ ë˜ëŒë¦¬ê¸°(ê°€ì¥ìµœì‹  ì‹œì )

- git checkout master