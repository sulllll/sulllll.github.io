---
layout: single
title:  "DAY-82 myBatis ë™ì  ì¿¼ë¦¬ (if, trim)"
categories: Spring
tag: [Spring myBatis ë™ì  ì¿¼ë¦¬ (if, trim)]
toc: true
toc_sticky: true
author_profile: false
sidebar:
  nav: "docs"
---

# ğŸ’»2022-06-30

<!--Quote-->
> â— ìˆ˜ì—…ì„ ë“£ê³ , ê°œì¸ì´ ê³µë¶€í•œ ë‚´ìš©ì„ ì ì€ ê²ƒ ì´ê¸°ì— ì˜¤ë¥˜ê°€ ë§ì„ ìˆ˜ë„ ìˆìŒ




# 1ï¸âƒ£ keyword ê²€ìƒ‰

```java
<!-- search1 -->
<select id="search1" parameterType="String" resultType="kh.message.dto.MessageDTO">
	select * from msg where nickname = #{nickname}
</select>
```

- í•´ë‹¹ ì½”ë“œëŠ” keywordê°€ ì •í™•íˆ ì¼ì¹˜í•´ì•¼ë§Œ ê²€ìƒ‰ì´ ëœë‹¤.

```java
<!-- search1 -->
<select id="search1" parameterType="String" resultType="kh.message.dto.MessageDTO">
	select * from msg where nickname like '%' || #{keyword} || '%'
</select>
```

- í•œ ê¸€ìë¼ë„ ê°™ìœ¼ë©´ ì¶œë ¥

---

# 2ï¸âƒ£ selectë¥¼ í™œìš©í•´ ê²°ê³¼ê°’ ì–»ì–´ì˜¤ê¸°

outputList.jsp

```jsx
<form id="searchForm2">
	<h2>ê²€ìƒ‰ ver2</h2>
	<span>
		<select name="category">
			<option value="all">ì „ì²´</option>
			<option value="no">ë²ˆí˜¸</option>
			<option value="nickname">ë‹‰ë„¤ì„</option>
			<option value="message">ë‚´ìš©</option>
		</select>
		<input type="text" name="keyword" placeholder="ê²€ìƒ‰">
		<button type="button" id="search2">ê²€ìƒ‰2</button>
	</span>
</form>

	<script>
	// ê²€ìƒ‰ ver2
	$("#search2").on("click",function() {
		let data = $("#searchForm2").serialize();
		console.log(data);
		$.ajax({
			url : "/search2",
			type: "get",
			data : data,
			success: function(data) {
				console.log(data);
				makeDynamicEl(data);
			},
			error : function(e) {
				console.log(e);
			}
		})

	})
	// ë™ì  í…Œì´ë¸” í•¨ìˆ˜
	let makeDynamicEl = function(data) {
		$("tbody").empty();
		if(data.length == 0) { // ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ
			let tr = $("<tr>");
			let td = $("<td colspan=5>").append("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤");
			tr.append(td);
			tr.appendTo("tbody");
		}else { // ê²€ìƒ‰ ê²°ê³¼ ìˆìŒ
			for(let dto of data) {
				let tr = $("<tr>");
				let td1 = $("<td>").append(dto.no);
				let td2 = $("<td>").append(dto.nickname);
				let td3 = $("<td>").append(dto.message);
				let modifyBtn = $("<button>").attr({
					type : "button",
					class : "modifyBtn",
					value : dto.no
				}).append("ìˆ˜ì •");

				let td4 = $("<td>").append(modifyBtn);

				let deleteBtn = $("<button>").attr({
					type : "button",
					class : "deleteBtn",
					value : dto.no
				}).append("ìˆ˜ì •");

				let td5 = $("<td>").append(deleteBtn);

				tr.append(td1, td2, td3, td4, td5);
				tr.appendTo("tbody");
			}
		}
	}
</script>
```
<span style="color: #2D3748; background-color:#fff5b1;">HomeController</span>


```java
@ResponseBody
@RequestMapping(value="/search2")
public List<MessageDTO> search2(String category,String keyword) throws Exception {
	System.out.println("ì¹´í…Œê³ ë¦¬ : " + category);
	System.out.println("í‚¤ì›Œë“œ : " + keyword);
	List<MessageDTO> list = service.search2(category,keyword);
	return list;
}
```
<span style="color: #2D3748; background-color:#fff5b1;">MessageService</span>


```java
// ê²€ìƒ‰ ver2
public List<MessageDTO> search2(String category,String keyword) throws Exception{
	return dao.search2(category,keyword);
}
```
<span style="color: #2D3748; background-color:#fff5b1;">MessageDAO</span>


```java
// ê²€ìƒ‰ ver2
public List<MessageDTO> search2(String category, String keyword) throws Exception{
	Map<String, String> map = new HashMap<>();
	map.put("category", category);
	map.put("keyword", keyword);
	return session.selectList("messageMapper.search1", map);
}
```

- selectListëŠ” ë‘ê°œì˜ ì¸ìë§Œ ë°›ê¸° ë•Œë¬¸ì— keyì™€ valueë¡œ ì–»ì–´ ì˜¬ ìˆ˜ ìˆëŠ” Mapì„ ì´ìš©í•œë‹¤.

<span style="color: #2D3748; background-color:#fff5b1;">message-mapper</span>


```java
<!-- if test ì¡°ê±´ë¬¸ ì•ˆì—ëŠ” daoì—ì„œ ë„˜ê²¨ì£¼ëŠ” ë³€ìˆ˜ëª…/í‚¤ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•¨. -->
<!-- search2 -->
<select id="search2" parameterType="map" resultType="kh.message.dto.MessageDTO">
	select * from msg where
		<if test="category == 'all'">
			select * from msg where no like '%' || #{keyword} || '%'
			or nickname like '%' || #{keyword} || '%'
			or message  like '%' || #{keyword} || '%'
		</if>
		<if test="category != 'all'">
			${category} like '%' || #{keyword} || '%'
		</if>
</select>
```

- parameterTypeì€ mapì´ ëœë‹¤.
- category ë¶€ë¶„ì—ì„œ $ë¥¼ ì‚¬ìš©í•œ ì´ìœ 
    1.  #ë¥¼ ì‚¬ìš©í•˜ë©´ â€˜â€™ ìœ¼ë¡œ ê°ì‹¸ì§€ê¸° ë•Œë¬¸ì— ì¿¼ë¦¬ ì‹¤í–‰ì´ ì•ˆëœë‹¤
    2. ë™ì  ì¿¼ë¦¬  ì‚¬ìš©ì„ ìœ„í•´ì„œ
- categoryê°€ allì´ ë“¤ì–´ì˜¤ë©´ ì¿¼ë¦¬ ì‹¤í–‰ (í…Œì´ë¸”ì—ëŠ” allì´ë¼ëŠ” ì»¬ëŸ¼ì´ ì—†ê¸° ë•Œë¬¸ì— ì¡°ê±´ë¬¸ìœ¼ë¡œ ì—¬ëŸ¬ê°œì˜ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰ì‹œì¼œì„œ ê²°ê³¼ë¥¼ ë°›ì•„ì•¼ í•œë‹¤)
- allì´ ì•„ë‹ˆë¼ë©´ categoryë¡œ ë“¤ì–´ì˜¤ëŠ” ê°’ì— ë”°ë¼ ì¿¼ë¦¬ ì‹¤í–‰

---
# 3ï¸âƒ£ ì²´í¬ë°•ìŠ¤ë¥¼ í™œìš©í•´ ê²°ê³¼ê°’ ì–»ì–´ì˜¤ê¸°

<span style="color: #2D3748; background-color:#fff5b1;">outputList.jsp</span>


```jsx

<!-- ê²€ìƒ‰3 -->
<form id="searchForm3">
	<h2>ê²€ìƒ‰ ver3</h2>
	<span>
		<input type="checkbox" id="all">ì „ì²´
		<input type="checkbox" name="no" value="no" class="category">ë²ˆí˜¸
		<input type="checkbox" name="nickname" value="nickname" class="category">ë‹‰ë„¤ì„
		<input type="checkbox" name="message" value="message" class="category">ë©”ì„¸ì§€
		<input type="text" name="keyword" placeholder="ê²€ìƒ‰">
		<button type="button" id="search3">ê²€ìƒ‰3</button>
	</span>
</form>

<script>
// ê²€ìƒ‰ 3
$("#all").on("click",function() {
	// ì „ì²´ ì²´í¬ ë²„íŠ¼ í´ë¦­ì‹œ ì „ì²´ ì„ íƒ or ì „ì²´ ì„ íƒ í•´ì œ
	//$(".category").prop("checked",this.checked);

	/* $("input:checkbox[id='all']").click(function() {
		if($(this).is(":checked")){
			$("input:checkbox[name='no']").prop("checked", true);
			$("input:checkbox[name='nickname']").prop("checked", true);
			$("input:checkbox[name='message']").prop("checked", true);

		} else{
			$("input:checkbox[name='no']").prop("checked", false);
			$("input:checkbox[name='nickname']").prop("checked", false);
			$("input:checkbox[name='message']").prop("checked", false);
		}
	}) */

	if(this.checked) { // ì „ì²´ ì„ íƒì´ ë˜ì—ˆì„ ë•Œ
			$(".category").prop("checked", true);

			// ê°œë³„ í•´ì œ ë¶ˆê°€ëŠ¥ í•˜ê²Œ ì„¤ì •
			$(".category").click(function(e) {
				e.preventDefault();
			})
		}else {  // ì „ì²´ë¥¼ í•´ì œí–ˆì„ ë•Œ
			$(".category").prop("checked", false);
			$(".category").unbind(); // ì‚¬ìš©ìê°€ ì§ì ‘ ë“±ë¡í•œ ì´ë²¤íŠ¸ë¥¼ ì œê±°
		}
})
</script>
```
<span style="color: #2D3748; background-color:#fff5b1;">message-mapper.xml</span>


```java
<!-- mybatisì—ì„œ ë¬¸ìì—´ ë¹ˆê°’ ì—¬ë¶€ ë¹„êµí• ë•ŒëŠ” != null ê·¸ë¦¬ê³  ''ë¥¼ ëª¨ë‘ í¬ë¡œìŠ¤ì²´í¬ í•´ì•¼í•¨(ë‘˜ë‹¤ í•´ì•¼í•¨) -->
<!-- search3 -->
<select id="search3" parameterType="map" resultType="kh.message.dto.MessageDTO">
	select * from msg where
	<trim prefixOverrides="or"> <!-- orê°€ ì¨ìˆìœ¼ë©´ ì—†ì• ì¤€ë‹¤ -->
		<!-- ì „ì²´ ì„ íƒìœ¼ë¡œ ë“¤ì–´ì™”ì„ ê²½ìš° -->
		<if test="no != null and no != ''"> <!-- ë²ˆí˜¸ë¥¼ ì²´í¬ í•œ ê²½ìš° -->
			no like '%' || #{keyword} || '%'
		</if>
		<if test="nickname != null and nickname != ''"> <!-- ë‹‰ë„¤ì„ ì²´í¬ í•œ ê²½ìš° -->
			or nickname like '%' || #{keyword} || '%'
		</if>
		<if test="message != null and message != ''"> <!-- ë©”ì„¸ì§€ ì²´í¬ í•œ ê²½ìš° -->
			or message like '%' || #{keyword} || '%'
		</if>
	</trim>
</select>
```

- mybatisì—ì„œ ë¬¸ìì—´ ë¹ˆê°’ ì—¬ë¶€ ë¹„êµí• ë•ŒëŠ” != null ê·¸ë¦¬ê³  ' 'ë¥¼ ëª¨ë‘ í¬ë¡œìŠ¤ ì²´í¬ í•´ì•¼í•¨(ë‘˜ ë‹¤ í•´ì•¼í•¨)
- trimì„  ì‚¬ìš©í•œ ì´ìœ ëŠ” ì „ì²´ ì¡°íšŒê°€ ì•„ë‹Œ í•˜ë‚˜ì”© ì¡°íšŒê°€ ë  ë•Œë„ ì‚¬ìš©ë˜ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— trimìœ¼ë¡œ ì¡°ê±´ì„ ì¤€ê²ƒ
- prefixì™€ prefixOverridesê°€ í•¨ê»˜ ì¡´ì¬í•œë‹¤ë©´ prefixOverridesê°€ ë¨¼ì € ì‹¤í–‰ëœë‹¤.

## ğŸ”” trim íƒœê·¸

- trim íƒœê·¸ ì•ˆìª½ì˜ ifë¬¸ì´ trueë¼ê³  í•œë‹¤ë©´ trimì´ ì‹¤í–‰ë˜ê³  falseë¼ê³  í•œë‹¤ë©´ ì‹¤í–‰ x
- ì•ˆìª½ì˜ ifë¬¸ì´ ì‹¤í–‰ëœë‹¤ë©´ ë‚´ê°€ ë¯¸ë¦¬ ì„¤ì •í•´ë‘” ë¬¸ìì—´ì„ ì¿¼ë¦¬ë¬¸ì— ë™ì ìœ¼ë¡œ ì¶”ê°€í•˜ê±°ë‚˜ ì¿¼ë¦¬ë¬¸ì—ì„œ ë™ì ìœ¼ë¡œ ì‚­ì œí•˜ëŠ” ê²ƒì´ ê°€ëŠ¥

1. prefix ì ‘ë‘ì‚¬ : ì¿¼ë¦¬ë¬¸ ê°€ì¥ ì•ìª½ì—ë‹¤ê°€ prefix ì†ì„±ì— ì¤€ ë¬¸ìì—´ì„ ë¶™ì—¬ì¤„ ìˆ˜ ìˆìŒ.
2. prefixOverrides ì ‘ë‘ì‚¬ ì œê±° : ì¿¼ë¦¬ë¬¸ ê°€ì¥ ì•ìª½ì— ìˆëŠ” ë¬¸ìì—´ì„ ì œê±°í•´ì£¼ëŠ” ì†ì„±
3. suffix ì ‘ë¯¸ì‚¬ : ì¿¼ë¦¬ë¬¸ì˜ ê°€ì¥ ë’¤ìª½ì—ë‹¤ ë¬¸ìì—´ì„ ë¶™ì—¬ì¤€ë‹¤.
4. suffixOverrides ì ‘ë¯¸ì‚¬ ì œê±° : ì¿¼ë¦¬ë¬¸ ê°€ì¥ ë’¤ìª½ì˜ ë¬¸ìì—´ì„ ì œê±°í•´ì£¼ëŠ” ì†ì„±