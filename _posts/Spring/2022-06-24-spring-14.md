---
layout: single
title:  "DAY-79 Spring ë‹¤ì¤‘ íŒŒì¼ ì—…ë¡œë“œ, ì¡°íšŒìˆ˜ ì—…ë°ì´íŠ¸, ORA-08002"
categories: Spring
tag: [Spring ë‹¤ì¤‘ íŒŒì¼ ì—…ë¡œë“œ, ì¡°íšŒìˆ˜ ì—…ë°ì´íŠ¸, ORA-08002]
toc: true
toc_sticky: true
author_profile: false
sidebar:
  nav: "docs"
---

# ğŸ’»2022-06-24

<!--Quote-->
> â— ìˆ˜ì—…ì„ ë“£ê³ , ê°œì¸ì´ ê³µë¶€í•œ ë‚´ìš©ì„ ì ì€ ê²ƒ ì´ê¸°ì— ì˜¤ë¥˜ê°€ ë§ì„ ìˆ˜ë„ ìˆìŒ
> â— ê°œì¸ê¸° ê³¼ì œë¥¼ í•œ ì½”ë“œë¼ ë¹„íš¨ìœ¨ì ì´ê³  ì˜¤ë¥˜ê°€ ë§ì„ ìˆ˜ë„ ìˆìŒ


# 1ï¸âƒ£ ë°˜ë“œì‹œ ì•Œê³  ê°€ì•¼í•  ê²ƒ

<span style="color: #2D3748; background-color:#fff5b1;">servlet-context.xml</span>


```java
<!-- í”„ë¡œí•„ ì‚¬ì§„ ê²½ë¡œ resources ì„¤ì • -->
<resources mapping="/board/*" location="/board/" />
```

- â— ë°˜ë“œì‹œ í•´ë‹¹ ê²½ë¡œë¥¼ Mapping í•´ì¤˜ì•¼í•œë‹¤ (ì´ê±¸ ëª»ì°¾ì•„ì„œ í•œì°¸ ì‹œê°„ì´ ê±¸ë¦¼)

# 2ï¸âƒ£ ì—…ë¡œë“œ ì—¬ëŸ¬ ê°œ í•˜ê¸°

<span style="color: #2D3748; background-color:#fff5b1;">writeBoard.jsp</span>


```javascript
<!--ê¸€ ì“°ê¸° ë‚´ìš©-->
<form id="boardForm">
	<div class="mb-3 mt-1">
		<label class="form-label">ì œëª©</label>
		<input type="text" class="form-control" id="title" name="title">
	</div>
	<div class="mb-3 mt-1">
		<label class="form-label">íŒŒì¼ì²¨ë¶€</label>
		<input type="file" class="form-control" id="file" name="file" multiple>
	</div>
	<div class="mb-3 mt-1">
		<label class="form-label">ë‚´ìš©</label>
		<textarea class="form-control" style="height: 150px" name="content"></textarea>
	</div>
</form>

<script>
// ë“±ë¡ë²„íŠ¼ ëˆŒë €ì„ ë•Œ
	$("#registerBtn").on("click",function(){
		console.log(document.getElementById("boardForm"));
		let data = new FormData(document.getElementById("boardForm"));
		$.ajax({
			url : "/board/registerBoard",
			type : "post", // file ë°ì´í„°ë¥¼ ë³´ë‚¼ë•ŒëŠ” postë¡œ í•´ì•¼í•œë‹¤
			contentType : false,
			processData : false,
			enctype : "multipart/form-data",
			data : data, // ìœ„ì—ì„œ ìƒì„±í•œ form // ì‚¬ì§„(multipart)ì™€ input(profile_message)ê°€ dataì— ë‹´ê²¨ìˆë‹¤.
			success : function(data) {
				if(data == "success") {
					location.href = "/board/toBoard";
				}else {
					console.log("ì‹¤íŒ¨");
				}
			},
			error : function(e) {
				console.log(e);
			}
		})
	})
</script>
```

<span style="color: #2D3748; background-color:#fff5b1;">BoardController.java</span>


```java
// ê¸€ë“±ë¡
@ResponseBody
@RequestMapping(value ="/registerBoard")
public String registerBoard(String title, String content, ArrayList<MultipartFile> file ) throws Exception {

	// ì„¸ì…˜ìœ¼ë¡œ ë¶€í„° ì•„ì´ë””, ë‹‰ë„¤ì„ ì–»ì–´ì˜¤ê¸°
	String writer_id = ((MemberDTO)session.getAttribute("loginSession")).getId();
	String writer_nickname = ((MemberDTO)session.getAttribute("loginSession")).getNickname();

	// dtoì— ê°’ë„£ì–´ì£¼ê¸°
	BoardDTO dto = new BoardDTO(0,title,content,writer_nickname,writer_id,0,null);

	// ë¹ˆ ê°’ìœ¼ë¡œ ë“¤ì–´ì˜¬ ê²½ìš°
	String board_image = "";

	// ë¯¸ë¦¬ ì´ë¯¸ì§€ì˜ ê²°ê³¼ë¥¼ ì„ ì–¸í•´ì£¼ê¸° return ë¬¸ì—ì„œ íŒë‹¨í•˜ê¸° ìœ„í•´
	String imageResult = "";

	// ê¸€ ì‚½ì… ì„±ê³µ ìœ ë¬´
	String insertResult = service.registerBoard(dto);
	System.out.println("ê²Œì‹œê¸€ ì‚½ì… ì„±ê³µ ìœ ë¬´ : " + insertResult);

	for (int i = 0; i < file.size(); i++) {
		if (!file.get(i).isEmpty()) {
			String realPath = session.getServletContext().getRealPath("board");
			System.out.println(realPath);
			board_image = service.uploadBoardImage(file.get(i), realPath);
		}
		//ì´ë¯¸ì§€ ì‚½ì…
		imageResult = service.registerBoardImage(board_image);
		System.out.println("ê²Œì‹œê¸€ ì´ë¯¸ì§€ ì„±ê³µ ìœ ë¬´ : " + imageResult);
	}

	System.out.println("board_image ì…ë‹ˆë‹¤ : " + board_image);

	if(insertResult.equals("success") && imageResult.equals("success")) {
		return "success";
	}else {
		return "fail";
	}
}
```

- BoardControllerì—ì„œ ê¸°ì¡´ì— íŒŒì¼ ì—…ë¡œë“œë¥¼ í•˜ë‚˜ ë§Œ í•  ë•ŒëŠ” MultipartFile ì´ì˜€ì§€ë§Œ ë‹¤ì¤‘ íŒŒì¼ì„ ë°›ì„ ë•ŒëŠ” ArrayList<MultipartFile> fileë¥¼ ì‚¬ìš©í•˜ì—¬ ë°˜ë³µë¬¸ì„ í†µí•´ ì´ë¯¸ì§€ë¥¼ ì‚½ì… í•´ì¤˜ì•¼ í•œë‹¤ â†’ ì¦‰ í•˜ë‚˜ì˜ seq_boardë¡œ ì—¬ëŸ¬ê°œì˜ ì‚¬ì§„ì´ ë“¤ì–´ ê°€ì•¼ í•œë‹¤.

<span style="color: #2D3748; background-color:#fff5b1;">BoardDAO.java</span>


```jsx
// ê²Œì‹œê¸€ ë“±ë¡ì‹œ ì‚¬ì§„ë„ ë“±ë¡
public int insertImage(String board_image) throws Exception {
	String sql = "insert into boardImage values (seq_board.currval, ?)";

	try(Connection con = bds.getConnection();
		PreparedStatement pstmt = con.prepareStatement(sql)) {

		pstmt.setString(1, board_image);
		int rs = pstmt.executeUpdate();
		return rs;
	}
}
```

- í•´ë‹¹ seq_boardì— ë§ëŠ” ì´ë¯¸ì§€ë¥¼ ë„£ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— currval ì´ìš©í•œë‹¤

## ğŸ§¨ ORA-08002

ì£¼ì˜ currval ì´ìš©ì‹œ ë°˜ë“œì‹œ nextvalì„ ë¨¼ì € ì‚¬ìš©í•´ì•¼ í•œë‹¤. ê·¸ë ‡ì§€ ì•Šë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.

```html
ORA-08002: sequence string.CURRVAL is not yet defined in this session

ì‹œí€€ìŠ¤ì˜ NETVAL ë³´ë‹¤ ë¨¼ì € CURRVALì´ í˜¸ì¶œë˜ì—ˆê¸° ë•Œë¬¸
ì¦‰, NEXTVALì´ ë¨¼ì € ì‹¤í–‰ë˜ì–´ì•¼ CURRVALì„ ì‹¤í–‰ ê°€ëŠ¥
```

# 3ï¸âƒ£ ì¡°íšŒìˆ˜ ì—…ë°ì´íŠ¸

<span style="color: #2D3748; background-color:#fff5b1;">BoardController.java</span>

```java
// í˜ì´ì§€ ìƒì„¸ë³´ê¸°
@RequestMapping(value="/detailView")
public String detailView(int seq_board,Model model) throws Exception {
	System.out.println(seq_board);

	// ë²ˆí˜¸ì— í•´ë‹¹í•˜ëŠ” ê²Œì‹œê¸€ ë‚´ìš© ë°ì´í„°
	ArrayList<BoardDTO> list = service.selectBySeqBoard(seq_board);

	// ë²ˆí˜¸ì— í•´ë‹¹í•˜ëŠ” ê²Œì‹œê¸€ ì¡°íšŒìˆ˜ ì—…ë°ì´íŠ¸
	int view_count = 0;
	for(BoardDTO dto : list) {
		view_count = dto.getView_count();
		view_count++;
	}
	int rs = service.updateViewCount(view_count, seq_board);
	if(rs > 0) System.out.println("ì—…ë°ì´íŠ¸ ì„±ê³µ");
	else System.out.println("ì—…ë°ì´íŠ¸ ì‹¤íŒ¨");

	// ë²ˆí˜¸ì— í•´ë‹¹í•˜ëŠ” ê²Œì‹œê¸€ ì´ë¯¸ì§€ ë°ì´í„°
	ArrayList<BoardImageDTO> imageList = service.selectImageBySeqBoard(seq_board);

	// ê°’ modelë¡œ ë‹´ì•„ì„œ ë³´ë‚´ê¸°
	model.addAttribute("list",list);
	model.addAttribute("imageList",imageList);

	return "board/detailView";
}
```

- ìƒì„¸ í˜ì´ì§€ë¥¼ ë“¤ì–´ê°”ì„ ë•Œ ì¡°íšŒìˆ˜ê°€ update ë˜ì–´ì•¼ í•˜ê¸°ì— detailViewì—ì„œ updateë¥¼ í•´ì¤˜ì•¼í•œë‹¤.
- ê¸°ë³¸ view_countëŠ” 0ì´ê¸°ì— ë¨¼ì € ì„ ì–¸í•´ì£¼ê³  ë²ˆí˜¸ì— í•´ë‹¹í•˜ëŠ” ê²Œì‹œê¸€ ë‚´ìš© ë°ì´í„°ì—ì„œ view_countë¥¼ ë½‘ì•„ì™€ í•˜ë‚˜ì”© ë”í•´ì¤€ë‹¤.