---
layout: single
title:  "DAY-75 Spring ë¼ì´ë¸ŒëŸ¬ë¦¬, ajax, í”„ë¡œí•„ ì´ë¯¸ì§€ ë³€ê²½"
categories: Spring
tag: [Spring ë¼ì´ë¸ŒëŸ¬ë¦¬, ajax, í”„ë¡œí•„ ì´ë¯¸ì§€ ë³€ê²½]
toc: true
toc_sticky: true
author_profile: false
sidebar:
  nav: "docs"
---

# ğŸ’»2022-06-20

## Spring

<!--Quote-->
> â— ìˆ˜ì—…ì„ ë“£ê³ , ê°œì¸ì´ ê³µë¶€í•œ ë‚´ìš©ì„ ì ì€ ê²ƒ ì´ê¸°ì— ì˜¤ë¥˜ê°€ ë§ì„ ìˆ˜ë„ ìˆìŒ

# 1ï¸âƒ£ Jackson Databind ë¼ì´ë¸ŒëŸ¬ë¦¬

- ìŠ¤í”„ë§ì—ì„œ ajax ì´ìš© ì‹œ gson ëŒ€ì‹  jackson databind ë¼ì´ë¸ŒëŸ¬ë¦¬ ì´ìš©
- jackson databindëŠ” string , list, ê°ì²´ íƒ€ì… ëª¨ë“  ë°ì´í„°ë¥¼ ì „ë‹¬ í•  ìˆ˜ ìˆë‹¤.


<span style="color: #2D3748; background-color:#fff5b1;">HomeController.java</span>

```java
@ResponseBody
@RequestMapping(value = "/deleteAjax")
public HashMap<String, Object> deleteAjax(int no) throws Exception {

	MessageDTO dto = dao.selectByNo(no);
	ArrayList<MessageDTO> list = dao.selectAll();

	// ê²½ìš°ì˜ ìˆ˜
  // dtoì™€ list ë‘ ê°œë¥¼ ë°˜í™˜í•´ì•¼ í•œë‹¤ / ë‹¤ë¥¸ ì¢…ë¥˜ì˜ list 2ê°œë¥¼ í•œë²ˆì— ë°˜í™˜í•´ì•¼í•˜ëŠ” ê²½ìš°
	// ë°˜í™˜ê°’ì€ ë”± í•˜ë‚˜ì—¬ì•¼ í•œë‹¤ -> dtoì™€ listë¥¼ ë‹´ëŠ” ë¬´ì–¸ê°€ê°€ ìˆì–´ì•¼ í•œë‹¤ -> HashMap ì´ìš©
	HashMap<String,Object> map = new HashMap<>();
	map.put("dto", dto);
	map.put("list",list);

	return map; // returnê°’ì´ ajaxë¥¼ ìš”ì²­í•œ í˜ì´ì§€ë¡œ ë‹¤ì‹œ ëŒì•„ê°
}
```

- dtoì™€ list ë‘ ê°œë¥¼ ë°˜í™˜í•´ì•¼ í•œë‹¤ / ë‹¤ë¥¸ ì¢…ë¥˜ì˜ list 2ê°œë¥¼ í•œë²ˆì— ë°˜í™˜ í•´ì•¼ í•˜ëŠ” ê²½ìš°
- ë°˜í™˜ ê°’ì€ ë”± í•˜ë‚˜ ì—¬ì•¼ í•œë‹¤ -> dtoì™€ listë¥¼ ë‹´ëŠ” ë¬´ì–¸ê°€ê°€ ìˆì–´ì•¼ í•œë‹¤ â†’ HashMap ì´ìš©


<span style="color: #2D3748; background-color:#fff5b1;">output2.jsp</span>

```javascript
// ì‚­ì œ ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œ confirm ì°½ì„ ë„ì›Œì¤Œ -> ì§„ì§œ ì‚­ì œí•˜ê² ë‹¤ë¼ê³  í•˜ë©´ ê·¸ ë•Œì˜ seq ë²ˆí˜¸ë¥¼ ì„œë²„ì— ì „ì†¡í•´ì„œ ì‚­ì œ
let deleteBtn = document.getElementsByClassName("deleteBtn");
for(i = 0; i < deleteBtn.length; i++) {
	deleteBtn[i].addEventListener("click",function() {
		let answer = confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
		console.log(answer);
		if(answer) {
			let val = this.value;
			$.ajax({
				url : "/deleteAjax",
				type : "post",
				data : {no : val},
				success : function(data) { // HomeControllerì—ì„œ returnìœ¼ë¡œ ë³´ë‚¸ê°’ì´ dataë¡œ ë„˜ì–´ì˜´
					console.log(data); // {list: Array(3), dto: {â€¦}}
					console.log(data.dto.no); // dto íƒ€ì…ì˜ no ë§Œ ì¶œë ¥
					console.log(data.list[0].nickname); // listì˜ 0ë²ˆì— ë‹‰ë„¤ì„ë§Œ ì¶œë ¥
				},
				error : function(e) {
					console.log(e);
				}
			})
		}
	});
}
```

- HomeControllerì—ì„œ ë„˜ì–´ì˜¨ dataëŠ” ê°ì²´ í˜•íƒœ(json)ì´ë©°, listì™€ dto ê°’ì´ ë“¤ì–´ìˆë‹¤.

# 2ï¸âƒ£ ë™ì ìœ¼ë¡œ ìƒì„±ëœ ìš”ì†Œì— ì´ë²¤íŠ¸ ì£¼ê¸°(ì‚­ì œ)


<span style="color: #2D3748; background-color:#fff5b1;">HomeController.java</span>

```java
// ë½‘ì•„ì˜¨ ë°ì´í„°ë¥¼ ë³´ì—¬ì£¼ëŠ” í˜ì´ì§€
@RequestMapping(value = "/toOutput2")
public String toOutput2() throws Exception {
	System.out.println("toOutput2 ìš”ì²­");
	return "output2";
}

// output2.jspì—ì„œ ajaxë¡œ ë°ì´í„° ìš”ì²­(í…Œì´ë¸”ë¡œ ë³´ì—¬ì§€ëŠ” ë°ì´í„°)
@ResponseBody
@RequestMapping(value = "/outputAjax")
public ArrayList<MessageDTO> outputAjax() throws Exception {
	ArrayList<MessageDTO> list = dao.selectAll();
	return list;
}

// ajaxë¡œ ë°ì´í„° ì‚­ì œ
// ajax ìš”ì²­ê°’ì— ëŒ€í•œ ë°˜í™˜ -> annotation(@ResponseBody)
@ResponseBody
@RequestMapping(value = "/deleteAjax")
public String deleteAjax(int no) throws Exception {
	int rs = dao.delete(no);
	if (rs > 0) {
		System.out.println("deleteAjax ì‚­ì œ ì„±ê³µ");
		return "success";
	}else {
		return "fail";
	}
}
```
<span style="color: #2D3748; background-color:#fff5b1;">output2.jsp</span>

```javascript
// ajax ìš”ì²­ì„ í†µí•´ ë°ì´í„° ê°€ì ¸ì™€ ë™ì ìœ¼ë¡œ ë¿Œë ¤ì£¼ëŠ” í•¨ìˆ˜
function makeDynamicEl() {
	$.ajax({
		url : "/outputAjax",
		success : function(data) {
			console.log(data);

			// ê¸°ì¡´ í…Œì´ë¸” ì‚­ì œ
			$("tbody").empty();

			// í…Œì´ë¸”ì„ ë™ì ìœ¼ë¡œ ìƒì„±
			for(let dto of data) {
				let td1 = $("<td>").append(dto.no);
				let td2 = $("<td>").append(dto.nickname);
				let td3 = $("<td>").append(dto.message);
				let deleteBtn = $("<button>").attr({"class" : "deleteBtn", "value" : dto.no}).append("ì‚­ì œ");
				let td4 = $("<td>").append(deleteBtn);
				let tr = $("<tr>").append(td1, td2, td3, td4);
				$("tbody").append(tr);
			}
		},
		error : function(e) {
			console.log(e);
		}
	})
}

// output2.jspê°€ ë¡œë“œë˜ë©´ ìë™ìœ¼ë¡œ ajax ìš”ì²­ì„ ë³´ë‚´ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ í›„ í…Œì´ë¸”ì„ ë™ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë¿Œë¦¬ê¸°
$(document).ready(function() {
	makeDynamicEl();
})

// í˜ì´ì§€ê°€ ë¡œë“œ ë  ë•ŒëŠ” deleteBtnì´ ì¡´ì¬í•˜ì§€ ì•Šì•„ì„œ(ajaxë¡œ ìƒì„±í–ˆê¸°ì—) ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤ -> ë¶€ëª¨ìš”ì†Œì— ì´ë²¤íŠ¸ ë°œìƒ ì‹œí‚¤ê¸°
$("tbody").on("click",".deleteBtn",function() {
	let answer = confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
	console.log(answer);

	// answer === true ë¼ë©´
	if(answer) {
		let val = this.value;
		console.log(val);

		$.ajax({
			url : "/deleteAjax",
			type : "post",
			data : {no : val},
			success : function(data) { // HomeControllerì—ì„œ returnìœ¼ë¡œ ë³´ë‚¸ê°’ì´ dataë¡œ ë„˜ì–´ì˜´
				console.log(data);
				if(data == "success") {
					// ì‚­ì œëœ ë°ì´í„°ë¥¼ ë°˜ì˜í•œ í…Œì´ë¸”ì„ ë¿Œë ¤ì¤„ ê²ƒ(ê¸°ì¡´ì˜ í…Œì´ë¸”ì„ ì‚­ì œí•˜ê³  ë°ì´í„° ë°›ì•„ì˜¤ê¸°)
					makeDynamicEl();
				}
				else if(data =="fail"){
					alert("ë°ì´í„° ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.")
				}
			},
			error : function(e) {
				console.log(e);
			}
		})
	}
})
```

- í˜ì´ì§€ê°€ ë¡œë“œ ë  ë•ŒëŠ” deleteBtnì´ ì¡´ì¬í•˜ì§€ ì•Šì•„ì„œ(ajaxë¡œ ìƒì„±í–ˆê¸°ì—) ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤ â†’ ë¶€ëª¨ì˜ ìš”ì†Œì¸ tbodyì— ì´ë²¤íŠ¸ë¥¼ ê±¸ì–´ì¤€ë‹¤

# 3ï¸âƒ£ Controller ìƒì„±

1. Controller ì–´ë…¸í…Œì´ì…˜ ë¶™ì—¬ì£¼ê¸°
2. servelt-context.xml ì—ì„œ component-scanì˜ ë²”ìœ„ë¥¼ ë°”ê¿”ì£¼ê¸°

```java
<context:component-scan base-package="kh.board.*"/>
```

ğŸ”” ê¸°ëŠ¥ë³„ Mapping í•˜ëŠ” ë²•


<span style="color: #2D3748; background-color:#fff5b1;">MemberController</span>

```java
//í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ì¤‘ memberë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ìš”ì²­ì€ ì´ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë°›ìŒ
@RequestMapping("/member")
@Controller
public class MemberController {

	// íšŒì›ê°€ì… í˜ì´ì§€ë¡œ ì´ë™
		@RequestMapping(value = "/toSignup")
		public String toSignup() {
			return "member/signup";
		}

}
```

- jspì˜ .mem .sh ì´ëŸ° ì‘ì—…ë“¤ì„ ìŠ¤í”„ë§ì—ì„œëŠ” Mappingìœ¼ë¡œ ëª…ì‹œí•´ì¤€ë‹¤

# 4ï¸âƒ£ ì´ë¯¸ì§€ ë¯¸ë¦¬ ë³´ê¸° (FileReader ì´ìš©)

- FileReader : javascriptì—ì„œ ë™ê¸° ë°©ì‹ìœ¼ë¡œ ì´ë¯¸ì§€ ì—…ë¡œë“œ êµ¬í˜„í•˜ëŠ” ê²½ìš°,ì„ íƒí•œ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©ì í™”ë©´ì— ë¯¸ë¦¬ ë³´ì—¬ì¤˜ì•¼ í•  ë•Œ ì‚¬ìš©
- ì‚¬ìš©ìê°€ profile_image íŒŒì¼ íƒœê·¸ë¥¼ ì´ìš©í•´ í”„ë¡œí•„ ì‚¬ì§„(ì´ë¯¸ì§€)ì„ ì„ íƒí–ˆì„ ë•Œ, profile_default ì´ë¯¸ì§€ íƒœê·¸ì— ì„ íƒëœ ì‚¬ì§„ì„ ë„ì›Œì£¼ëŠ” ì‘ì—…
- [ì œë¡œì´ˆ ë¸”ë¡œê·¸](https://www.zerocho.com/category/HTML&DOM/post/592827558653d6001804a0a5)

<span style="color: #2D3748; background-color:#fff5b1;">signup.jsp</span>

```html
<body>
<form id="signupForm" action="" method="post" enctype="multipart/form-data">
	<div class="container mt-xl-4">
      <!-- í”„ë¡œí•„ -->
      <div class="row mt-1">
        <div class="col d-flex flex-column justify-content-center mt-1 align-items-center">
          <div class="profile_border mt-2">
          	<img src="../resources/images/default.png" id="profile_default">
          </div>
          <p class="mt-2">í”„ë¡œí•„ ë“±ë¡</p>
          <input class="form-control w-50" type="file" id="profile_image">
        </div>
      </div>
	</div>
</form>

<script>
//ì‚¬ìš©ìê°€ íŒŒì¼íƒœê·¸ë¥¼ ì´ìš©í•´ íŒŒì¼ì„ ì„ íƒí–ˆì„ ë•Œ ì‚¬ìš©ìì˜ ë¡œì»¬ì— ìˆëŠ” íŒŒì¼ì˜ ì •ë³´ë¥¼ ë¸Œë¼ìš°ì €ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•˜ê²Œë” í•´ì£¼ëŠ” í´ë˜ìŠ¤
document.getElementById("profile_image").onchange = function() {
	let reader  = new FileReader();
	reader.readAsDataURL(this.files[0]); // -> ì¸ìê°’ìœ¼ë¡œ file íƒœê·¸ë¥¼ ë„˜ê²¨ì¤€ë‹¤.

	// onload í•¨ìˆ˜ê°€ íŠ¸ë¦¬ê±°ë¨ -> onload
	reader.onload = function(e) {
		console.log("e.target.result", e.target.result); // ì´ë¯¸ì§€ì˜ ê²½ë¡œê°€ ë„ì¶œ

		// ê¸°ì¡´ì˜ default ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©ìê°€ ì—…ë¡œë“œí•œ ì´ë¯¸ì§€ë¡œ ë³€ê²½
		document.getElementById("profile_default").src = e.target.result;
	}
}
</script>
</body>
```

1. FileReader ìƒì„± í›„, ì‚¬ìš©ìê°€ ì„ íƒí•œ ì´ë¯¸ì§€ì˜ ë°ì´í„° ê°’ì„ FileReaderì— ë„£ì–´ì¤€ë‹¤.
2. FileReaderê°€ ìƒˆë¡œ ë‹´ê²¼ì„ ë•Œ ì´ë¯¸ì§€ì˜ ì£¼ì†Œ ê°’ì„ ìƒˆë¡­ê²Œ ë³€ê²½ í•´ì¤€ë‹¤

# 5ï¸âƒ£ ì—¬ëŸ¬ ê°œì˜ íŒŒì¼ ì˜¬ë¦¬ê¸°(commons ë¼ì´ë¸ŒëŸ¬ë¦¬)

- commons fileupload ë¼ì´ë¸ŒëŸ¬ë¦¬ ì´ìš©
- servlet-context.xmlì— bean ìƒì„± í•´ì•¼ í•œë‹¤

```java
<!-- multipartResolver bean ìƒì„± -->
<beans:bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
	<beans:property name="maxUploadSize" value="10485760"></beans:property>    <!-- ìµœëŒ€ íŒŒì¼ í¬ê¸° 10MB -->
</beans:bean>
```

- ì´ë•Œ, idëŠ” ë°˜ë“œì‹œ multipartResolver ì´ì—¬ì•¼ í•œë‹¤

## â—org.springframework.validation.BeanPropertyBindingResult ì—ëŸ¬ ë°œìƒ

<span style="color: #2D3748; background-color:#fff5b1;">signup.jsp</span>

```html
<form id="signupForm" action="/member/singup" method="post" enctype="multipart/form-data">
	<div class="container mt-xl-4">
      <!-- í”„ë¡œí•„ -->
      <div class="row mt-1">
        <div class="col d-flex flex-column justify-content-center mt-1 align-items-center">
          <div class="profile_border mt-2">
          	<img src="../resources/images/default.png" id="profile_default">
          </div>
          <p class="mt-2">í”„ë¡œí•„ ë“±ë¡</p>
          <input class="form-control w-50" type="file" id="profile_image" name="profile_image">
        </div>
      </div>
	</div>
</form>
```

- idê°€ profile_imageì¸ inputì˜ nameì´ â€œprofile_imageâ€ì´ë‹¤


<span style="color: #2D3748; background-color:#fff5b1;">MemberController.java</span>

```java
// signup.jspì—ì„œ submitì„ ëˆŒë €ì„ ë•Œ ë“¤ì–´ì˜¤ëŠ” ë©”ì„œë“œ
// íŒŒì¼ ë°ì´í„°ëŠ” MultipartFile í˜• ë³€ìˆ˜ë¡œ ë°›ì•„ì¤Œ
@RequestMapping(value ="/singup")
public String signup(MemberDTO dto, MultipartFile profile_image) throws Exception{
	System.out.println("singup ì ‘ì† ì™„ë£Œ");
	System.out.println(dto.toString());
	System.out.println("file: " + profile_image);
	return "";
}
```

- í˜„ì¬ MemberDTOì˜ ë³€ìˆ˜ ì¤‘ profile_imageê°€ ì¡´ì¬í•œë‹¤. â†’ Type mismatchì—ëŸ¬ ë°œìƒ
- ì¦‰ MultipartFileë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” DTOì— ì¡´ì¬í•˜ëŠ” ë³€ìˆ˜ëª…ì„ ì‚¬ìš© í•´ì„  ì•ˆëœë‹¤.

## ğŸ’¡ í•´ê²° ë°©ë²•

singup.jspì—ì„œ idê°€ profile_imageì¸ inputì˜ nameì„ ë‹¤ë¥¸ ì´ë¦„ ex) fileë¡œ ë³€ê²½ í›„ MemberController.javaì—ì„œ ê°’ì„ ë°›ëŠ” ì¸ìë„ fileë¡œ ë³€ê²½ì„ í•´ì¤€ë‹¤

<span style="color: #2D3748; background-color:#fff5b1;">signup.jsp</span>

```html
<form id="signupForm" action="/member/singup" method="post" enctype="multipart/form-data">
	<div class="container mt-xl-4">
      <!-- í”„ë¡œí•„ -->
      <div class="row mt-1">
        <div class="col d-flex flex-column justify-content-center mt-1 align-items-center">
          <div class="profile_border mt-2">
          	<img src="../resources/images/default.png" id="profile_default">
          </div>
          <p class="mt-2">í”„ë¡œí•„ ë“±ë¡</p>
          <input class="form-control w-50" type="file" id="profile_image" name="file">
        </div>
      </div>
	</div>
</form>
```
<span style="color: #2D3748; background-color:#fff5b1;">MemberController.java</span>

```java
// signup.jspì—ì„œ submitì„ ëˆŒë €ì„ ë•Œ ë“¤ì–´ì˜¤ëŠ” ë©”ì„œë“œ
// íŒŒì¼ ë°ì´í„°ëŠ” MultipartFile í˜• ë³€ìˆ˜ë¡œ ë°›ì•„ì¤Œ
@RequestMapping(value ="/singup")
public String signup(MemberDTO dto, MultipartFile file) throws Exception{
	System.out.println("singup ì ‘ì† ì™„ë£Œ");
	System.out.println(dto.toString());
	System.out.println("file: " + file);
	return "";
}
```