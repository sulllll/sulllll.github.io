---
layout: single
title:  "DAY-83 ì²´í¬ë°•ìŠ¤ ajaxë¡œ ë°ì´í„° ë³´ë‚´ê¸° ,myBatis Join, selectKey"
categories: MyBatis
tag: [Spring ì²´í¬ë°•ìŠ¤, myBatis Join, selectKey]
toc: true
toc_sticky: true
author_profile: true
sidebar:
  nav: "docs"
---

# ğŸ’»2022-07-01

<!--Quote-->
> â— ìˆ˜ì—…ì„ ë“£ê³ , ê°œì¸ì´ ê³µë¶€í•œ ë‚´ìš©ì„ ì ì€ ê²ƒ ì´ê¸°ì— ì˜¤ë¥˜ê°€ ë§ì„ ìˆ˜ë„ ìˆìŒ


# 1ï¸âƒ£ ì²´í¬ë°•ìŠ¤ë¡œ ì‚­ì œí•˜ê¸°(ë§´ë²„ ê´€ë¦¬ í•„ìš”)

![1.png](/assets/images/posts/2022-07-01/1.png)

<span style="color: #2D3748; background-color:#fff5b1;">outputList.jsp</span>


<script src="https://gist.github.com/kimyeong96/20b14436ee4ea93e686b42ae7c48ae4e.js"></script>

<span style="color: #2D3748; background-color:#fff5b1;">HomeController.java</span>


<script src="https://gist.github.com/kimyeong96/143b6ef50130fa07c1a97cfaac10b931.js"></script>

<span style="color: #2D3748; background-color:#fff5b1;">MessageService</span>


<script src="https://gist.github.com/kimyeong96/0484090170620c4154e0d986defb2c92.js"></script>

<span style="color: #2D3748; background-color:#fff5b1;">MessageDAO - 1ë²ˆ</span>


<script src="https://gist.github.com/kimyeong96/32d206845cf81d85fb7622904a8d4dc0.js"></script>

<span style="color: #2D3748; background-color:#fff5b1;">MessageDAO - 2ë²ˆ</span>


<script src="https://gist.github.com/kimyeong96/8adfffa4ad49e0ed5f832ec28a52dfe9.js"></script>

<span style="color: #2D3748; background-color:#fff5b1;">message-mapper.xml - 1ë²ˆ</span>


```java
<!-- ë©”ì„¸ì§€ ì‚­ì œ(ì²´í¬ë°•ìŠ¤) -->
<!-- 1. daoë¡œ ë¶€í„° ë°°ì—´/ë¦¬ìŠ¤íŠ¸ê°€ ìˆëŠ” ê°’ ê·¸ëŒ€ë¡œ ë„˜ì–´ì˜¤ëŠ” ê²½ìš° (ë©”ì„¸ì§€ ì„ íƒ ì‚­ì œ) -->
<!-- foreach (daoì—ì„œ ë°°ì—´ í˜¹ì€ ë¦¬ìŠ¤íŠ¸ê°€ ë„˜ì–´ì˜¤ëŠ” ê²½ìš°ì—ë§Œ ì‚¬ìš© ê°€ëŠ¥) -->
<delete id="deleteChecked" parameterType="int">
	delete from msg where no in
		<foreach collection="array" item="num" open="(" close=")" separator=",">
			#{num}
		</foreach>
</delete>
```
<span style="color: #2D3748; background-color:#fff5b1;">message-mapper.xml - 2ë²ˆ</span>


```java
<!-- ë©”ì„¸ì§€ ì‚­ì œ(ì²´í¬ë°•ìŠ¤) -->
<!-- 2. keyê°’ì„ ê°€ì§€ê³  ë°°ì—´ / ë¦¬ìŠ¤íŠ¸ë¥¼ ë„˜ê¸°ëŠ” ê²½ìš° -->
<!-- collection : ì†ì„±ê°’ì— ë°˜ë“œì‹œ ë„˜ì–´ì˜¤ëŠ” keyê°’ì„ ì‚¬ìš©í•´ì„œ ë°ì´í„°ë¥¼ ë°›ì•„ì¤˜ì•¼í•¨ -->
<delete id="deleteChecked" parameterType="int">
	delete from msg where no in
		<foreach collection="deleteArr" item="num" open="(" close=")" separator=",">
			#{num}
		</foreach>
</delete>
```

## myBatis (forEach)

1. collection : daoë¡œë¶€í„° ë„˜ì–´ì˜¤ëŠ” ë°°ì—´ / ë¦¬ìŠ¤íŠ¸ì˜ ì´ë¦„ (jstl forEachë¬¸ì˜ itemsì™€ ê°™ì€ ì—­í• )

â†’ daoì—ì„œ ë°°ì—´ì´ë‚˜ ë¦¬ìŠ¤íŠ¸í•œí…Œ ë³„ë„ì˜ ì´ë¦„(key)ì„ ë¶™ì—¬ì£¼ì§€ ì•Šê³  ë°°ì—´ / ë¦¬ìŠ¤íŠ¸ ê·¸ëŒ€ë¡œ ë„˜ê²¨ì£¼ëŠ” ê²½ìš°ì—ëŠ” ë°°ì—´ì¼ ê²½ìš° array ë¦¬ìŠ¤íŠ¸ì¼ ê²½ìš° listë¼ëŠ” ë³„ì¹­ì„ ë¶€ì—¬í•œë‹¤.

1. item : ë°°ì—´ì´ë‚˜ ë¦¬ìŠ¤íŠ¸ë¥¼ ë°˜ëª©ë¬¸ ëŒë¦¬ë©° ê°ê° ì¸ë±ìŠ¤ì— ìˆëŠ” ê°’ì„ ë‹´ì•„ì¤„ ë³€ìˆ˜(jstl forEachë¬¸ì˜ varì™€ ê°™ì€ ì—­í• )
2. open : prefix ì²˜ëŸ¼ ë°˜ë³µë˜ëŠ” êµ¬ë¬¸ì˜ ê°€ì¥ ì•ìª½ì— íŠ¹ì • ë¬¸ìì—´ì„ ì¶”ê°€ (myBatisì˜ prefix ê°™ì€ ëŠë‚Œ)
3. close : suffix ì²˜ëŸ¼ ë°˜ë³µë˜ëŠ” êµ¬ë¬¸ì˜ ê°€ì¥ ë’¤ìª½ì— íŠ¹ì • ë¬¸ìì—´ì„ ì¶”ê°€
4. seperator : í•œë²ˆ ë°˜ë³µí•œ í›„ ë’¤ì— ë˜ ë°˜ë³µì´ ì´ì–´ì§„ë‹¤ë©´ êµ¬ë¶„ìë¥¼ ì¶”ê°€í•´ì£¼ëŠ” ì†ì„±

# 2ï¸âƒ£ myBatis - Join

<span style="color: #2D3748; background-color:#fff5b1;">message-mapper.xml</span>


```java
<!-- ì¡°ì¸ëœ í…Œì´ë¸”ì˜ ë°ì´í„° ì¡°íšŒ -->
<select id="selectJoin" resultType="map" >
	select nickname, message, address, phone from msg join member using (nickname)
</select>
```

- ë°˜í™˜ê°’ì€ mapìœ¼ë¡œ í•´ì•¼í•œë‹¤. â†’ êº¼ë‚¼ ë•Œë„ ëŒ€ë¬¸ìë¡œ ê°€ì ¸ì™€ì•¼í•œë‹¤(jspì—ì„œ)

ë¼ì´ë¸ŒëŸ¬ë¦¬ ì ìš©í›„

<span style="color: #2D3748; background-color:#fff5b1;">message-mapper.xml</span>


```java
<!-- ì¡°ì¸ëœ í…Œì´ë¸”ì˜ ë°ì´í„° ì¡°íšŒ -->
<select id="selectJoin" resultType = "org.apache.commons.collections4.map.CaseInsensitiveMap">
	select nickname, message, address, phone from msg join member using (nickname)
</select>
```
<span style="color: #2D3748; background-color:#fff5b1;">MessageService.java</span>


<script src="https://gist.github.com/kimyeong96/f1e33b3787662188f90229cab8333167.js"></script>

<span style="color: #2D3748; background-color:#fff5b1;">MessageDAO</span>


<script src="https://gist.github.com/kimyeong96/6b4c0b0f3836a0b712730f147c580eac.js"></script>

<span style="color: #2D3748; background-color:#fff5b1;">outputJoinList.jsp</span>


<script src="https://gist.github.com/kimyeong96/28a6346653e4ae80758bd42c68fd1c69.js"></script>

- í…Œì´ë¸”ì—ëŠ” ì»¬ëŸ¼ëª…ì´ ëŒ€ë¬¸ìë¡œ ë“¤ì–´ê°€ê¸° ë•Œë¬¸ì— join ì‚¬ìš© ì‹œ ê°’ì„ ê°€ì ¸ì˜¬ ë•Œë„ ëŒ€ë¬¸ìë¡œ ê°€ì ¸ì™€ì•¼í•œë‹¤ ->commons-collections4 ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ ì†Œë¬¸ìë¡œ ì‚¬ìš©ê°€ëŠ¥

# 3ï¸âƒ£ selectKey

- order : selectKey íƒœê·¸ê°€ ë“¤ì–´ìˆëŠ” êµ¬ë¬¸ì„ ìˆ˜í–‰í•˜ê¸° ì „ì— ì¶”ì¶œí•´ì˜¤ê³ ì í•˜ëŠ” ê°’ì„ ê°€ì ¸ì˜¬ ê±´ì§€
í˜¹ì€ ì¿¼ë¦¬ë¬¸ì´ ì‹¤í–‰ëœ í›„ì— ê°’ì„ ê°€ì ¸ì˜¬ ê±´ì§€ ì—¬ë¶€ì— ëŒ€í•œ ì†ì„±  â†’ before / after
- keyProperty : selectKeyê°€ ì‹¤í–‰ë˜ê³  ë‚œ ê²°ê³¼ ê°’ì„ ì €ì¥í•  ë³€ìˆ˜ëª…
- resultType : selectKeyì•ˆì˜ êµ¬ë¬¸ì´ ì‹¤í–‰ëì„ë•Œ ë°˜í™˜ ë°›ì„ ë°ì´í„°ì˜ íƒ€ì…

## BEFORE

```java
<!-- ë©”ì„¸ì§€ ì €ì¥ BEFORE ì‚¬ìš©-->
<insert id="insert" parameterType="kh.message.dto.MessageDTO">
	<selectKey order="BEFORE" keyProperty="no" resultType="int">
		select seq_msg.nextval from dual
	</selectKey>
	insert into msg values(#{no}, #{nickname}, #{message})
</insert>
```

ê¸°ì¡´ì˜ insert into msg values(#{no}, #{nickname}, #{message}) ì—ì„œëŠ” seq_msg.nextvalì„ ë„£ì–´ì¤¬ë‹¤. í•˜ì§€ë§Œ selectKeyë¥¼ ì´ìš©í•˜ë©´ ë¨¼ì € seq_msgë¥¼ êµ¬í•œë’¤, MessageDTOì— noì„ ë„£ì–´ì£¼ê³  ê·¸ ê°’ì„ insertë¬¸ìœ¼ë¡œ ëŒë ¤ì¤€ë‹¤. (ê·¸ë˜ì„œ #{no} ì‚¬ìš© ê°€ëŠ¥)

- keyPropertyì˜ ê°’ì€ ë°˜ë“œì‹œ DTOì˜ ê°’ê³¼ ì¼ì¹˜í•´ì•¼ setterë¥¼ í†µí•´ ê°’ì„ ì„¤ì •í•´ì¤€ë‹¤.
- SQL êµ¬ë¬¸ ì „ì— ì‚¬ìš©
- nextval ì‚¬ìš©

## AFTER

```java
<!-- ë©”ì„¸ì§€ ì €ì¥ AFTER ì‚¬ìš©-->
<insert id="insert" parameterType="kh.message.dto.MessageDTO">
	insert into msg values(seq_msg.nextval, #{nickname}, #{message})
	<selectKey order="AFTER" keyProperty="no" resultType="int">
		select seq_msg.currval from dual
	</selectKey>
</insert>
```

- sql êµ¬ë¬¸ ë’¤ì— selectKeyë¥¼ ì‚¬ìš©
- nextvalì´ ì•„ë‹Œ currval ì‚¬ìš©