---
layout: single
title:  "DAY-73 Spring ì´ˆê¸° í™˜ê²½ì„¤ì •, annotation, redirect"
categories: Spring
tag: [Spring ì´ˆê¸° í™˜ê²½ì„¤ì •, annotation, redirect]
toc: true
toc_sticky: true
author_profile: false
sidebar:
  nav: "docs"
---

# ğŸ’»2022-06-16

<!--Quote-->
> â— ìˆ˜ì—…ì„ ë“£ê³ , ê°œì¸ì´ ê³µë¶€í•œ ë‚´ìš©ì„ ì ì€ ê²ƒ ì´ê¸°ì— ì˜¤ë¥˜ê°€ ë§ì„ ìˆ˜ë„ ìˆìŒ



# 1ï¸âƒ£ ì‹œì‘

- facets(ìë°”,webModuel)í™•ì¸ -> pom.xml ìˆ˜ì •(ìë°” ë²„ì „,ìŠ¤í”„ë§ ë²„ì „,loggin)
- home.jspì— <%@ page language="java" contentType="text/html; charset=UTF-8"
pageEncoding="UTF-8"%> ë„£ì–´ì¤˜ì•¼ í•¨(ìƒˆë¡œ ë§Œë“œëŠ” jspëŠ” ìë™ìœ¼ë¡œ ìƒê¸°ì§€ë§Œ í”„ë¡œì íŠ¸ ìƒì„± ì‹œ home.jspì—ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠìŒ)

# 2ï¸âƒ£ ê°’ ë°›ê¸°
<span style="color: #2D3748; background-color:#fff5b1;">input.jsp</span>

```html
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Input</title>
</head>
<body>
	<form method="post" action="/sendInput">
		<label>nickname : </label>
		<input type="text" name="nickname" placeholder="ë‹‰ë„¤ì„ ì…ë ¥">
		<label>message : </label>
		<input type="text" name ="message" placeholder="ë©”ì„¸ì§€ ì…ë ¥">
		<button type="submit">ì „ì†¡</button>
	</form>
</body>
</html>
```

## 1. ê¸°ì¡´ ë°©ë²•(jsp)

```java
@RequestMapping(value = "/sendInput")
	public String sendInput(HttpServletRequest request) {
		System.out.println("sendInput ìš”ì²­");

		String nickname = request.getParameter("nickname");
		String message = request.getParameter("message");

		System.out.println("nickname : " + nickname);
		System.out.println("message : " + message);
		return "";
	}
```

- requestë¥¼ ì´ìš©í•´ ê°’ì„ ë°›ì•„ì˜¨ë‹¤

## 2. spring ë°©ë²•

```java
@RequestMapping(value = "/sendInput")
public String sendInput(String nickname, String message) {
	System.out.println("sendInput ìš”ì²­");
	System.out.println(nickname + " : " + message);
	return "";
}
```

- input.jspì•ˆì˜ inputì˜ nameê³¼ sendInputì˜ ì¸ìì˜ nameê³¼ ì¼ì¹˜ í•œë‹¤ë©´ ê°’ì´ ì¶œë ¥ëœë‹¤.
- input.jspì•ˆì˜ inputì˜ nameê³¼ sendInputì˜ ì¸ìë¡œ ë„£ìœ¼ë©´ null ê°’ì´ ì¶œë ¥ëœë‹¤.

> ì¦‰ inputì˜ nameê³¼ Methodì˜ ì¸ìê°€ ê°™ì•„ì•¼ í•œë‹¤
>

## 3. setter ì´ìš© (ë§ì€ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¬ ë•Œ)

<span style="color: #2D3748; background-color:#fff5b1;">messageDTO</span>

```java
package com.message.dto;

public class MessageDTO {
	private String nickname;
	private String message;

	public MessageDTO() {}

	public MessageDTO(String nickname, String message) {
		this.nickname = nickname;
		this.message = message;
	}

	public String getNickname() {
		return nickname;
	}

	public void setNickname(String nickname) {
		this.nickname = nickname;
	}

	public String getMessage() {
		return message;
	}

	public void setMessage(String message) {
		this.message = message;
	}

	@Override
	public String toString() {
		return "nickname=" + nickname + ", message=" + message;
	}
}
```

- setter ì´ìš©

```java
/* ê°’ ë°›ê¸° ë°©ë²•3 -> command ê°ì²´ë¡œ ì „ë‹¬ ë°›ê¸° -> dto íƒ€ì…ìœ¼ë¡œ ë°ì´í„° ë°›ê¸° ê°€ëŠ¥
	* defualt -> DTOì˜ ê¸°ë³¸ìƒì„±ìë¡œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±
	* í´ë¼ì´ì–¸íŠ¸ê°€ ë„˜ê²¨ì£¼ëŠ” ë°ì´í„°ì˜ nameê°’ì„ ì´ìš©í•´ì„œ
	* nameê°’ê³¼ ë™ì¼í•œ ì´ë¦„ì˜ setterë¥¼ ì°¾ì•„ ê·¸ ì„¸í„°ë¥¼ ì´ìš©í•´ í´ë¼ì´ì–¸íŠ¸ê°€ ë³´ë‚¸ ë°ì´í„°ë¥¼ ì¸ìŠ¤í„´ìŠ¤ì— ì…‹íŒ…í•˜ëŠ” ì‘ì—…
	*
*/
	@RequestMapping(value = "/sendInput")
	public String sendInput(MessageDTO dto) {
		System.out.println("sendInput ìš”ì²­");
		System.out.println(dto.toString());
		return "";
	}
```

- input.jspì˜ inputì˜ nameê³¼ dtoì˜ ë³€ìˆ˜ëª…ì´ ê°™ì•„ì•¼í•œë‹¤



# 3ï¸âƒ£ ê°’ ì „ë‹¬

- controllerì—ì„œ jspë¡œ ì „ë‹¬í•˜ëŠ” ë°©ì‹ : ê¸°ì¡´ì˜ requestëŒ€ì‹ Model ì´ë¼ëŠ” ê°ì²´ë¥¼ ì´ìš©
- controllerì˜ ëª¨ë“  RequestMappingëœ ë©”ì„œë“œì˜ ëª¨ë“  default ë¦¬í„´ ë°©ì‹ì€ forwardë¡œ ë™ì‘ â†’ forwardë¥¼ í•´ì£¼ì§€ ì•Šì•„ë„ ë°ì´í„°ê°€ ì „ë‹¬ëœë‹¤.

```java

@RequestMapping(value = "/sendInput")
public String sendInput(MessageDTO dto, Model model) {
	System.out.println("sendInput ìš”ì²­");
	System.out.println(dto.toString());

	model.addAttribute("dto", dto); // jspì˜ setAttribute ëŒ€ì‹  addAttribute ì‚¬ìš©
	return "/output";

	// springì˜ redirect ì‚¬ìš© ë°©ë²• -> redirect:"ìš”ì²­url" = sendRedirectë‘ ê°™ë‹¤(ë°ì´í„° ì „ì†¡x)
	// return "redirect:/toOutput";
}
```
<span style="color: #2D3748; background-color:#fff5b1;">output.jsp</span>

```html
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Output</title>
</head>
<body>
	<table border="1">
		<thead>
			<tr>
				<th>nickname</th>
				<th>message</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>${dto.nickname}</td>
				<td>${dto.message}</td>
			</tr>
		</tbody>
	</table>
</body>
</html>
```

- jspì²˜ëŸ¼ ${} ë°©ì‹ìœ¼ë¡œ ê°’ ë„ì¶œ


# 4ï¸âƒ£ dbì™€ ê´€ë ¨ëœ ì½”ë“œ

ğŸ’¡ webapp â†’  WEB-INF â†’ spring â†’ root-context.xmlì—ì„œ dbì½”ë“œë¥¼ ë„£ëŠ”ë‹¤

## 1. sql developer ê³„ì • ë§Œë“¤ê¸°

1. system ê³„ì •ìœ¼ë¡œ ì ‘ì†
2. ìƒì„±í•  ê³„ì • ì•„ì´ë”” ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í›„ ê¶Œí•œ ë¶€ì—¬

```java
create user msg identified by msg;
grant connect, resource, dba to msg;
```


## 2. Springì—ì„œ dbcp ì—°ê²°(bean ì´ìš©)

```java
<!-- dbcp (ì»¤ë„¥ì…˜ í’€) ì¸ìŠ¤í„´ìŠ¤ ìƒì„± setter ì´ìš© ì£¼ì…-->
<bean id="bds" class="org.apache.commons.dbcp2.BasicDataSource">
	<property name="driverClassName" value="oracle.jdbc.driver.OracleDriver"/>
	<property name="url" value="jdbc:oracle:thin:@localhost:1521:xe"/>
	<property name="username" value="msg"/>
	<property name="password" value="msg"/>
	<property name="initialSize" value="30"/>
</bean>
```


ğŸ’¡ beanì„ ë“±ë¡í•˜ë©´ ê¸°ë³¸ì ìœ¼ë¡œ singletonìœ¼ë¡œ ìƒì„±

# 5ï¸âƒ£ ì–´ë…¸í…Œì´ì…˜

- ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ ì§ì ‘ ì£¼ì… í•´ì£¼ëŠ”ê²Œ ì•„ë‹Œ, ìë™ì ìœ¼ë¡œ ì£¼ì…ì„ í•´ì¤€ë‹¤.



WEB-INF â†’ spring â†’ appServlet â†’ servlet-context.xmlì—ì„œ

```java
<context:component-scan base-package="com.message.controller"/>
```

í•´ë‹¹ ì½”ë“œëŠ” com.message.controllerë§Œ scan í•œë‹¤ â†’ ë‹¤ë¥¸ ë²”ìœ„ë„ scan í•˜ê¸° ìœ„í•´ì„ 

```java
<context:component-scan base-package="com.message.*"/>
```

## 1.**Autowired** , **Repository**


<span style="color: #2D3748; background-color:#fff5b1;">root-context.xml</span>


```java
<!-- dbcp (ì»¤ë„¥ì…˜ í’€) ì¸ìŠ¤í„´ìŠ¤ ìƒì„± setter ì´ìš© ì£¼ì…-->
<bean id="bds" class="org.apache.commons.dbcp2.BasicDataSource">
	<property name="driverClassName" value="oracle.jdbc.driver.OracleDriver"/>
	<property name="url" value="jdbc:oracle:thin:@localhost:1521:xe"/>
	<property name="username" value="msg"/>
	<property name="password" value="msg"/>
	<property name="initialSize" value="30"/>
</bean>
```

<span style="color: #2D3748; background-color:#fff5b1;">MessageDAO</span>


```java
@Repository
public class MessageDAO {
	@Autowired
	private BasicDataSource bds; // Autowired ì—­í•  : bds ë¼ëŠ” ì´ë¦„ê°’ì˜ beanì´ ìˆëŠ”ì§€ íƒìƒ‰
															// -> root-context.xml ì—ì„œ ë°œê²¬
	public MessageDAO() {
		System.out.println("Message DAO ì¸ìŠ¤í„´ìŠ¤ ìƒì„±");
	}

	public int insert(MessageDTO dto) throws Exception {
		String sql = "insert into msg values(?,?)";

		try(Connection con = bds.getConnection();
			PreparedStatement pstmt = con.prepareStatement(sql)) {

			pstmt.setString(1, dto.getNickname());
			pstmt.setString(2, dto.getMessage());

			int rs = pstmt.executeUpdate();
			return rs;
		}
	}
}
```

- MessageDAO í˜• ì¸ìŠ¤í„´ìŠ¤ ìƒì„± (ìƒì„±ë  ë‹¹ì‹œì—ëŠ” bdsë¼ëŠ” ë§´ë²„í•„ë“œëŠ” null)
- @Autowired  ë‹¬ë ¤ìˆëŠ” ë©¤ë²„í•„ë“œëŠ” ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ í•´ë‹¹ ìë£Œí˜•ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¾ì•„ì„œ ê·¸ ë©¤ë²„í•„ë“œì— ê°’ì„ ì…‹íŒ…í•´ì£¼ëŠ” ì‘ì—…ì„ ì•Œì•„ì„œ í•´ì£¼ëŠ” annotation
- @**<U>Autowired</U>** : MessageDAOì˜ ê°ì²´ ì´ë¦„ì„ root-contextì˜ bean ì¤‘ì— idê°€ bdsì¸ ê²ƒì„ ì°¾ëŠ”ë‹¤
- @**<U>Repository</U>** : ì§ì ‘ì ìœ¼ë¡œ dbì— ë°ì´í„°ë¥¼ ì „ë‹¬/ìˆ˜ì •/ì‚­ì œ/ì¡°íšŒ í•˜ëŠ” í´ë˜ìŠ¤ì—  ë¶™ì—¬ì¤€ë‹¤ (dao) â†’ ì¦‰ MessageDAOì˜ ì–´ë…¸í…Œì´ì…˜ì€ Controllerê°€ ë˜ë©´ ì•ˆëœë‹¤.


<span style="color: #2D3748; background-color:#fff5b1;">HomeController.java</span>

```java
package com.message.controller;

@Controller
public class HomeController {

	@Autowired
	private MessageDAO dao; // ì´ ìƒíƒœë¡œë§Œ ë‘ë©´ nullì´ê¸°ì— autowiredë¥¼ í†µí•´ MessageDAOì˜ ê°’ë“¤ì„ ìë™ìœ¼ë¡œ ì£¼ì…ì‹œì¼œì¤€ë‹¤

	public HomeController() {
		System.out.println("HomeController ì¸ìŠ¤í„´ìŠ¤ ìƒì„±");
	}

	@RequestMapping(value = "/sendInput")
	public String sendInput(MessageDTO dto, Model model) {
		System.out.println("sendInput ìš”ì²­");
		System.out.println(dto.toString());

		// Springì—ì„œëŠ” ê¸°ì¡´ì˜ jsp ë°©ì‹ëŒ€ë¡œ MessageDAO ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“œëŠ” ì‘ì—…ì€ í•˜ì§€ ì•ŠëŠ”ë‹¤(ëª¨ë“  uriì— í•˜ë‚˜ì”© ìƒì„± í–ˆì—ˆìŒ).
		// ex) MessageDAO dao = new MessageDAO();

		// @Autowired
		//  private MessageDAO dao; ë§¨ìœ„ ì½”ë“œ ìƒì„±

		try {
			int rs = dao.insert(dto);
			if(rs > 0) {
				System.out.println("dbì— insert ì„±ê³µ");
			}
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		// model.addAttribute("dto", dto); // jspì˜ setAttribute ëŒ€ì‹  addAttribute ì‚¬ìš©
		return "output";
		// springì˜ redirect ì‚¬ìš© ë°©ë²•
		// return "redirect:/toOutput";
	}
}
```

### ğŸ”” ê²°ë¡ 

- Controllerë¥¼ ë‹´ë‹¹í•˜ëŠ” HomeControllerëŠ” **@Controller ì´ìš©**
- ìë™ ì£¼ì…ì‹œ @**Autowired ì´ìš©**
- dbì™€ ì—°ê´€ëœ classëŠ” @**Repository ì´ìš©**

â— ì¡°ì‹¬


<span style="color: #2D3748; background-color:#fff5b1;">HomeController</span>

```java
@RequestMapping(value = "/")
	public String home() {
		return "home";
	}

@RequestMapping(value = "/sendInput")
	public String sendInput(MessageDTO dto, Model model) {
		System.out.println("sendInput ìš”ì²­");
		System.out.println(dto.toString());

		// Springì—ì„œëŠ” ê¸°ì¡´ì˜ jsp ë°©ì‹ëŒ€ë¡œ MessageDAO ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“œëŠ” ì‘ì—…ì€ í•˜ì§€ ì•ŠëŠ”ë‹¤(ëª¨ë“  uriì— í•˜ë‚˜ì”© ìƒì„± í–ˆì—ˆìŒ).
		// ex) MessageDAO dao = new MessageDAO();

		try {
			int rs = dao.insert(dto);
			if(rs > 0) {
				System.out.println("dbì— insert ì„±ê³µ");
			}
		} catch (Exception e) {
			e.printStackTrace();
			return "redirect:/toError";
		}

		// model.addAttribute("dto", dto); // jspì˜ setAttribute ëŒ€ì‹  addAttribute ì‚¬ìš©
		return "redirect:/"; // home í™”ë©´ìœ¼ë¡œ ëŒë ¤ì£¼ê¸°
												// return "home"ìœ¼ë¡œ í•˜ë©´ ë°ì´í„°ê°€ ë˜ ë‹¤ì‹œ ë³´ë‚´ì§„ë‹¤(forward)ì´ê¸°ì—
	}
```

- spring ì—ì„œ returnì„ í•  ë•ŒëŠ” forwardê°€ ê¸°ë³¸ ì „ì œì´ë‹¤. ë”°ë¼ì„œ return â€œhomeâ€ ì´ëŸ°ì‹ìœ¼ë¡œ ì‘ì„±í•˜ê²Œ ë˜ë©´, ë°ì´í„°ê°€ ì¤‘ë³µì ìœ¼ë¡œ ë³´ë‚´ì§„ë‹¤. â†’ ê·¸ë˜ì„œ  í˜ì´ì§€ë¥¼ ì´ë™í•˜ê¸° ìœ„í•´ì„œëŠ” ë°˜ë“œì‹œ â€œredirect:/â€ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
- ë‹¨ìˆœ return "viewName"ê°™ì€ ê²½ìš°ëŠ” viewNameì— í•´ë‹¹í•˜ëŠ” viewë¥¼ ë³´ì—¬ì£¼ëŠ” ê²ƒì´ê³ , return "redirect:/"ê°™ì€ ê²½ìš°ëŠ” redirect ì˜¤ë¥¸ìª½ì˜ ì£¼ì†Œë¡œ **URL ìš”ì²­ì„ ë‹¤ì‹œ í•˜ëŠ” ê²ƒ** ê·¸ë¡œ ì¸í•´ ì£¼ì†Œê°€ ë°”ë€ë‹¤.(return "viewName" ê°™ì€ ê²½ìš° í™”ë©´ë§Œ viewNameìœ¼ë¡œ ë°”ë€Œê³  urlì€ ì•ˆë°”ë€œ)

> í˜ì´ì§€ ì´ë™ì‹œì—ëŠ” redirectë¥¼ ì´ìš©í•œë‹¤.