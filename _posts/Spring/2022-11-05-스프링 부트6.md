---
layout: single
title:  "ìŠ¤í”„ë§ ë¶€íŠ¸ ê¸°ì´ˆ - 6(íšŒì›ê°€ì…, ë¡œê·¸ì¸ êµ¬í˜„)"
categories: SpringBoot
tag: [SpringBoot,íšŒì›ê°€ì…, ë¡œê·¸ì¸ ]
toc: true
toc_sticky: true
author_profile: true
sidebar:
  nav: "docs"
---


## ì˜ˆì™¸ ì²˜ë¦¬

```java
@ControllerAdvice	// Exceptionì´ ë°œìƒí–ˆì„ ë•Œ ì´ìª½ìœ¼ë¡œ ë“¤ì–´ì˜¤ê²Œ í•˜ê¸° ìœ„í•´
@RestController
public class GlobalExceptionHandler {

	@ExceptionHandler(value = IllegalArgumentException.class)
	public String handleArgumentException(IllegalArgumentException e) {
		return "<h1>" + e.getMessage() +"</h1>" ;
	}
}
```
<br/>

## íšŒì›ê°€ì…

â–¶ joinForm

```java
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
  <!-- header import -->
  <!-- userì—ì„œ í•œì¹¸ ì˜¬ë¼ê°€ì•¼ ì°¾ì„ ìˆ˜ ìˆìŒ -->
  <%@ include file="../layout/header.jsp"%>

  <div class="container">
    <form class="mt-3">
      <div class="form-group">
        <label for="username mt-3">Username</label>
        <input type="text" class="form-control" id="username" aria-describedby="emailHelp" placeholder="Enter username">
      </div>
      <div class="form-group mt-3">
        <label for="password">Password</label>
        <input type="password" class="form-control" id="password" placeholder="password">
      </div>
      <div class="form-group mt-3">
        <label for="Email">Email</label>
        <input type="email" class="form-control" id="email" aria-describedby="emailHelp" placeholder="Enter email">
      </div>
      <!-- <div class="form-group form-check">
      <input type="checkbox" class="form-check-input" id="exampleCheck1"> <label class="form-check-label" for="exampleCheck1">Check me out</label>
    </div> -->
    </form>
    <button type="button" class="btn btn-primary mt-3" id="btn-save">íšŒì›ê°€ì…ì™„ë£Œ</button>
  </div>

  <script src="/js/user.js">
  </script>

  <!-- footer import -->
  <!-- userì—ì„œ í•œì¹¸ ì˜¬ë¼ê°€ì•¼ ì°¾ì„ ìˆ˜ ìˆìŒ -->
  <%@ include file="../layout/footer.jsp"%>
</body>
</html>
```

- headerì™€ footerë¥¼ ë¶„ë¦¬í•´ì„œ includeë¥¼ í™œìš©í•´ì„œ í˜ì´ì§€ë¡œ ê°€ì ¸ì˜¨ë‹¤
- buttonì„ ëˆ„ë¥´ê³  ì•„ë˜ì˜ scriptë¥¼ í†µí•´ì„œ ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ì´ ëœë‹¤

<br/><br/>

â–¶ user.js

```javascript
let index = {
	init: function() {
		$("#btn-save").on("click", () => {
			this.save();
		})
	},

	save: function() {
    //alert("userì˜ save í•¨ìˆ˜ í˜¸ì¶œë¨");
    let data = {
			username : $("#username").val(),
			password : $("#password").val(),
			email : $("#email").val(),
		}
	}
}

index.init();
```
<br/><br/>

â–¶ UserApiController

```java
@RestController
public class UserApiController {

	@PostMapping(value = "/api/user")
	public ResponseDto<Integer> save(@RequestBody User user) {
		System.out.println("UserApiController í˜¸ì¶œ");
		return new ResponseDto<Integer>(HttpStatus.OK,1);
	}
}
```

@RequestBody â†’ JSON ë°ì´í„°ë¥¼ ë°›ê¸° ìœ„í•´ @RequestParam ëŒ€ì‹  ì‚¬ìš©

@RequestBody ì™€ @RequestParamì€ ë°ì´í„°ë¥¼ ë°›ê¸° ìœ„í•œ ë°©ë²•ì´ë‹¤.

@RequestParamê°™ì€ ê²½ìš° urlì„ í†µí•´ì„œ ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ìœ¼ë¡œ ì˜¤ëŠ” ê°’ì„ ì½ì–´ë“¤ ì¼ ë•Œ ì‚¬ìš©ëœë‹¤. ë°˜ë©´

@RequestBody ê°™ì€ ê²½ìš° bodyì— ë°ì´í„°ë¥¼ ë‹´ì•„ì„œ ë³´ë‚´ì˜¨ ê°’ì„ ì½ì–´ë“¤ ì¼ ë•Œ ì‚¬ìš©ëœë‹¤. JSON ë°ì´í„¸ë¥´ ë³´ë‚´ê¸° ìœ„í•´ì„  bodyì— ë°ì´í„°ë¥¼ ë‹´ì•„ ë³´ë‚´ê¸°ì— @RequestBody ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

|  | @RequestBody  | @RequestParam |
| --- | --- | --- |
| ê°ì²´ ìƒì„± | ê°€ëŠ¥ | ë¶ˆê°€ëŠ¥  |
| ê° ë³€ìˆ˜ë³„ë¡œ ë°ì´í„° ì €ì¥  | ë¶ˆê°€ëŠ¥ | ê°€ëŠ¥ |


<br/><br/>

## ì „í†µì ì¸ ë¡œê·¸ì¸

â–¶  loginForm.jsp

```java
<div class="container">
  <form class="mt-3">
    <div class="form-group">
      <label for="username mt-3">Username</label>
      <input type="text" class="form-control" id="username" placeholder="Enter username">
    </div>
    <div class="form-group mt-3">
      <label for="password">Password</label>
      <input type="password" class="form-control" id="password" placeholder="Enter password">
    </div>
  </form>
  <button type="button" class="btn btn-primary mt-3" id="btn-login">ë¡œê·¸ì¸</button>
</div>

<script src="/js/user.js"></script>
```

usernameê³¼ passwordë¥¼ ì…ë ¥í•˜ê³  í´ë¦­ì„ ëˆ„ë¥´ê²Œ ë˜ê³  , ì•„ë˜ì˜ scriptê°€ ìˆœì°¨ì ìœ¼ë¡œ ì‘ë™

<br/><br/>

â–¶ user.js

```javascript
let index = {
	init: function() {
		$("#btn-login").on("click", () => {
			this.login();
		});
	},

  login: function() {
      //alert("userì˜ save í•¨ìˆ˜ í˜¸ì¶œë¨");
      let data = {
		username : $("#username").val(),
		password : $("#password").val(),
	}

	$.ajax({
		type : "POST",
		url : "/api/user/login",
		data : JSON.stringify(data), 	// ìë°”ì—ì„œ ì²˜ë¦¬ í•˜ê¸° ìœ„í•´ì„œ jsonìœ¼ë¡œ ë³€ê²½
		contentType : "application/json; charset=utf-8",
		dataType : "json"
	}).done(function(resp) {
		alert("ë¡œê·¸ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
		console.log(resp);
		location.href = "/"
	}).fail(function(error) {
		alert(JSON.stringify(error));
	});	// ajax í†µì‹ ì„ ì´ìš©í•´ì„œ 3ê°œì˜ ë°ì´í„°ë¥¼ jsonìœ¼ë¡œ ë³€ê²½í•˜ì—¬ insert ìš”ì²­
  }
}

index.init();
```

idê°€ btn-loginì¸ ë²„íŠ¼ì„ í´ë¦­ì‹œ login í•¨ìˆ˜ ì‹¤í–‰
<br/><br/>

â–¶ UserApiController

```java
@PostMapping(value = "/api/user/login")
public ResponseDto<Integer> login(@RequestBody User user, HttpSession session) {
	System.out.println("UserApiController:login í˜¸ì¶œë¨");
	User principal = userService.ë¡œê·¸ì¸(user); // principal(ì ‘ê·¼ì£¼ì²´)

	if(principal != null) {
		System.out.println("ë¡œê·¸ì¸ ì„±ê³µ");
		session.setAttribute("principal", principal);// ì„¸ì…˜ ë§Œë“¤ê¸°
	}
	return new ResponseDto<Integer>(HttpStatus.OK.value(),1);
}
```

ë¡œê·¸ì¸ formì—ì„œ ì…ë ¥í•œ usernameê³¼ passwordê°€ ë“¤ì–´ì˜¤ê³ , service í˜¸ì¶œ

<br/><br/>

â–¶ UserApiController

```java
@Service
public class UserService {

	@Autowired
	private UserRepository userRepository;

	@Transactional(readOnly = true) // select í•  ë•Œ íŠ¸ëœì­ì…˜ ì‹œì‘, ì„œë¹„ìŠ¤ ì¢…ë£Œì‹œì— íŠ¸ëœì­ì…˜ ì¢…ë£Œ(ì •í•©ì„±)
	public User ë¡œê·¸ì¸(User user) {
		System.out.println("Service ë“¤ì–´ì˜´");
		return userRepository.findByUsernameAndPassword(user.getUsername(), user.getPassword());
	}
}
```

userRepositoryë¥¼ í˜¸ì¶œí•˜ëŠ”ë° findByUsernameAndPasswordë¼ëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì„œ ì‚¬ìš© ì—¬ê¸°ì„œ Usernameê³¼ PasswordëŠ” ê°ê° user.getUsername(), user.getPassword() ê°’ë“¤ì´ ë“¤ì–´ê°„ë‹¤.

<br/><br/>

â–¶ UserRepository

```java
public interface UserRepository extends JpaRepository<User, Integer>{	// Userë¼ëŠ” í´ë˜ìŠ¤, IntegerëŠ” Userì˜ primary keyì˜ íƒ€ì…
	// JPA Naming ì¿¼ë¦¬ ì „ëµ
	// select * from user where username = ? and password = ?; ì‹ì˜ ì¿¼ë¦¬ë¡œ ë³€ê²½ë˜ë²„ë¦¼ ?ì—ëŠ” usernameê³¼ passwordê°’ìœ¼ ë“¤ì–´ê°
	User findByUsernameAndPassword(String username, String password);

	// ìœ„ì™€ ê°™ë‹¤
	//@Query(value ="select * from user where username = ? and password = ?", nativeQuery = true)
	//User login(String username, String password);
}
```

findByUsernameAndPasswordë¥¼ ì´ìš©í–ˆë‹¤. ì´ëŠ” JPAì—ì„œ ì œê³µí•˜ëŠ” findByë¥¼ ì´ìš©í•œ ê²ƒì´ê³  ë’¤ì˜ Username And Passwordì—ì„œ Usernameê³¼ PasswordëŠ” dbì˜ ì»¬ëŸ¼ëª…ê³¼ ì¼ì¹˜í•´ì•¼í•œë‹¤. findByë¡œ ì‹œì‘ì„ í•˜ë©´ ì¿¼ë¦¬ë¥¼ ìš”ì²­í•˜ëŠ” ë©”ì„œë“œë¥¼ ì•Œë¦¬ëŠ” ê²ƒì´ë‹¤.

findByë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ì¹´ë©œì¼€ì´ìŠ¤ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤.

![1.png](/assets/images/posts/2022-11-05/1.png)



## ğŸ“‘ ì¶œì²˜

 - [ë©”íƒ€ì½”ë”©](https://www.youtube.com/c/%EB%A9%94%ED%83%80%EC%BD%94%EB%94%A9/playlists)
 - [@RequestBody ì„¤ëª…](https://ocblog.tistory.com/49)
