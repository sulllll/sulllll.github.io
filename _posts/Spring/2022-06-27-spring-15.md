---
layout: single
title:  "DAY-80 Spring í’€ì´ ë¹„êµ, íŒŒì¼ ë‹¤ìš´ë¡œë“œ, ê²Œì‹œê¸€ ìˆ˜ì •, ê²Œì‹œê¸€ ì‚­ì œ"
categories: Spring
tag: [Spring í’€ì´ ë¹„êµ, íŒŒì¼ ë‹¤ìš´ë¡œë“œ, ê²Œì‹œê¸€ ìˆ˜ì •, ê²Œì‹œê¸€ ì‚­ì œ]
toc: true
toc_sticky: true
author_profile: false
sidebar:
  nav: "docs"
---

# ğŸ’»2022-06-27

<!--Quote-->
> â— ìˆ˜ì—…ì„ ë“£ê³ , ê°œì¸ì´ ê³µë¶€í•œ ë‚´ìš©ì„ ì ì€ ê²ƒ ì´ê¸°ì— ì˜¤ë¥˜ê°€ ë§ì„ ìˆ˜ë„ ìˆìŒ

# 1ï¸âƒ£ í’€ì´ ë°©ì‹

## ë‚´ê°€ í‘¼ ë°©ì‹

```java
@RequestMapping(value ="/registerBoard")
	public String registerBoard(String title, String content, ArrayList<MultipartFile> file ) throws Exception {
		// ì„¸ì…˜ìœ¼ë¡œ ë¶€í„° ì•„ì´ë””, ë‹‰ë„¤ì„ ì–»ì–´ì˜¤ê¸°
		String writer_id = ((MemberDTO)session.getAttribute("loginSession")).getId();
		String writer_nickname = ((MemberDTO)session.getAttribute("loginSession")).getNickname();
	}
```

- Controllerì—ì„œ sessionì˜ ê°’ì„ ì–»ì–´ ì™”ë‹¤.
- MultipartFileì„ ArrayListë¡œ ë°›ì•˜ë‹¤.

## ìˆ˜ì—…
<span style="color: #2D3748; background-color:#fff5b1;">write.jsp</span>

```html
<!-- sessionì˜ ê°’ì„ ì•ˆë³´ì´ê²Œ í•˜ê³  sessionì˜ ì•„ì´ë””ì™€ ë‹‰ë„¤ì„ ê°’ì„ ì „ë‹¬í•˜ê²Œ í•œë‹¤ -->
<div class="d-none">
	<input type="text" name="writer_id" value="${loginSession.id}">
	<input type="text" name="writer_nickname" value="${loginSession.nickname}">
</div>
```

- ê²Œì‹œê¸€ì„ ì“¸ ë•Œ ì•„ì´ë””ì™€ ë‹‰ë„¤ì„ì„ controllerë¡œ ë³´ë‚´ëŠ” ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©
- write.jsp ì—ì„œ controllerë¡œ ë³´ëƒ„


<span style="color: #2D3748; background-color:#fff5b1;">DB</span>


```java
-- ì´ë¯¸ì§€ ì €ì¥ í…Œì´ë¸”
create table files(
    seq_file number primary key,
    seq_board number not null,
    ori_name varchar2(500),
    sys_name varchar2(1000),
    constraints bf_key foreign key(seq_board) references board(seq_board)
);
```
<span style="color: #2D3748; background-color:#fff5b1;">BoardController</span>

```java
// ê²Œì‹œê¸€ ì‘ì„± ìš”ì²­
@RequestMapping(value = "/write")
public String writer(BoardDTO dto, MultipartFile[] files) throws Exception {
	System.out.println(dto.toString());
	System.out.println(files[0]);
	System.out.println(files[1]);
	// boardDTO ì €ì¥ // FILE ì—…ë¡œë“œ // fileDTO ì €ì¥

	return "";
}
```

- MultipartFileì„ ArrayListê°€ ì•„ë‹Œ ì¼ë°˜ ë°°ì—´ë¡œ ë°›ì•˜ë‹¤

### ğŸ”” í¬ê²Œ ë‹¤ë¥¸ì 

- ê¸°ë³¸ì ìœ¼ë¡œ ìˆ˜ì—…ì—ì„œ ì‚¬ìš©í•œ ë°©ì‹ì€ dbì— ì €ì¥í•  ë•Œ currvalê³¼ nextvalì„ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ë‹¤. ëŒ€ì‹  daoì—ì„œ select seq_board.nextval from dual; ë¥¼ í†µí•´ seq_board ê°’ì„ ê°€ì ¸ì™€ ê¸€ ë°ì´í„°ë¥¼ ë„£ì„ ë•Œ, ì´ë¯¸ì§€ ë°ì´í„°ë¥¼ ë„£ì„ ë•Œ ì‚¬ìš©í•˜ì˜€ë‹¤.

# 2ï¸âƒ£ Date â†’ String ë³€ê²½

<span style="color: #2D3748; background-color:#fff5b1;">BoardDTO</span>


```java
// ì‘ì„±ì¼ì„ ì˜¤ë¼í´ Date íƒ€ì…ìœ¼ë¡œ ë°›ì„ ìˆ˜ ìˆëŠ” ìƒì„±ì ì˜¤ë²„ë¼ì´ë”©
public BoardDTO(int seq_board, String title, String content, String writer_nickname, String writer_id,
	int view_count, Date written_date) {
	this.seq_board = seq_board;
	this.title = title;
	this.content = content;
	this.writer_nickname = writer_nickname;
	this.writer_id = writer_id;
	this.view_count = view_count;
	this.written_date = getStrDate(written_date);
}

// dateë¥¼ string ìœ¼ë¡œ ë³€í™˜
public String getStrDate(Date date){
	String rs = null;
	try {
		SimpleDateFormat sdf = new SimpleDateFormat("yyë…„MMì›”ddì¼ hh:mm:ss");
		rs = sdf.format(date);
	}catch(Exception e) {
		e.printStackTrace();
	}
	return rs;
}
```
<span style="color: #2D3748; background-color:#fff5b1;">BoardDAO</span>


```java
// ê²Œì‹œê¸€ ë°ì´í„° ì¡°íšŒ
public List<BoardDTO> selectAll() throws Exception {
	String sql = "select * from board";

	try (Connection con = bds.getConnection();
		PreparedStatement pstmt = con.prepareStatement(sql)) {

		ResultSet rs = pstmt.executeQuery();
		// ListëŠ” ArrayListì˜ ë¶€ëª¨ íƒ€ì… -> ë‹¤í˜•ì„± ê°€ëŠ¥
		List<BoardDTO> list = new ArrayList<>();
		while(rs.next()) {
			int seq_board = rs.getInt("seq_board");
			String title = rs.getString("title");
			String content = rs.getString("content");
			String writer_nickname = rs.getString("writer_nickname");
			String writer_id = rs.getString("writer_id");
			int view_count = rs.getInt("view_count");
			Date written_date = rs.getDate("written_date");
			list.add(new BoardDTO(seq_board,title,content,writer_nickname, writer_id, view_count, written_date));
		}

		return list;
	}
}
```

- ê¸°ì¡´ì˜ daoì—ì„œ í•´ì¤¬ë˜ dateâ†’Stringìœ¼ë¡œ ë°”ê¿”ì¤¬ë˜ ì‘ì—…ì„  dtoì—ì„œ ìƒì„±ìë¥¼ í†µí•´ í•´ì¤€ë‹¤
- boardDAOì—ì„œ DBì—ì„œ Date íƒ€ì…ì¸ written_dateë¥¼ ê·¸ëŒ€ë¡œ dtoë¡œ ë„˜ê²¨ì¤€ë‹¤

# 3ï¸âƒ£ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
<span style="color: #2D3748; background-color:#fff5b1;">detail.jsp</span>


```java
<!-- íŒŒì¼ ìœ ë¬´ -->
<div class="mb-3 mt-1">
	<label class="form-label">ì²¨ë¶€íŒŒì¼</label>
	<ul class="list-group">
		<c:if test="${map.fileList.size() == 0}">
			<li class="list-group-item"><b>ì²¨ë¶€ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</b></li>
		</c:if>
		<c:if test="${map.fileList.size() > 0}">
			<c:forEach items="${map.fileList}" var="fileDTO">
				<li class="list-group-item"><a href="/file/download?sys_name=${fileDTO.sys_name}&ori_name=${fileDTO.ori_name}">${fileDTO.ori_name}</a></li>
			</c:forEach>
		</c:if>
	</ul>
</div>
```

- íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ í•  ìˆ˜ ìˆê²Œ sys_nameê³¼ ori_nameì„ ì»¨íŠ¸ë¡¤ëŸ¬ì— ë³´ë‚´ì¤€ë‹¤.

<span style="color: #2D3748; background-color:#fff5b1;">FileController</span>


```java
// íŒŒì¼ ë‹¤ìš´ë¡œë“œ
@RequestMapping(value="/download")
public void download(HttpServletResponse response, String ori_name, String sys_name) throws Exception {

	System.out.println("ori_name : " + ori_name);
	System.out.println("sys_name : " + sys_name);

	String filePath = session.getServletContext().getRealPath("board");
	// FileInputStreamì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ íŒŒì¼ì˜ full ê²½ë¡œë¥¼ ì´ìš©í•´ File ê°ì²´ ìƒì„±
	File targetFile = new File(filePath + File.separator + sys_name);
	// íŒŒì¼ì˜ full ê²½ë¡œ ì–»ì–´ë‚´ê¸°
	System.out.println("targetFile : " + targetFile.getPath());

	// ori_nameì´ í•œê¸€ ì¼ ìˆ˜ ë„ìˆê¸°ë•Œë¬¸ì— ì¸ì½”ë”©
	ori_name = new String(ori_name.getBytes(), "ISO-8859-1");

	// ì‘ë‹µë˜ëŠ” ê°’ì´ ì¼ë°˜ë°ì´í„°ê°€ ì•„ë‹Œ íŒŒì¼ ë‹¤ìš´ë¡œë“œì— ëŒ€í•œ ìµ¸ì—‰ì´ë¼ëŠ” ê²ƒì„ response headerì— ì…‹íŒ…
	response.setHeader("Content-Disposition", "attachment; filename=\"" + ori_name + "\";");

	try(DataInputStream dis = new DataInputStream(new FileInputStream(targetFile));
		DataOutputStream dos = new DataOutputStream(response.getOutputStream())) {

		// íŒŒì¼ì„ í•œë²ˆì— ë°”ì´íŠ¸ ë°°ì—´ë¡œ ë¶ˆëŸ¬ ë“¤ì´ê¸°
		byte[] arr = dis.readAllBytes();
		// íŒŒì¼ì„ í•œë²ˆì— ë³´ë‚´ì£¼ê¸°
		dos.write(arr);
		dos.flush();
	}
}
```

# 4ï¸âƒ£ ê²Œì‹œê¸€ ì‚­ì œ

<span style="color: #2D3748; background-color:#fff5b1;">detail.jsp</span>


```javascript

<!-- ìˆ¨ê²¨ì§„ ë°ì´í„° ì˜ì—­ -->
<div class="d-none">
	<input type="text" value="${map.boardDTO.seq_board}" name="seq_board" id="seq_board">
</div>

<script>
// ì‚­ì œ ë²„íŠ¼ í´ë¦­
$("#delete").on("click",function() {
	let answer = confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
	if(answer) {
		// ë™ì  form ìƒì„±
		let deleteForm = $("<form>").attr({
			"method" : "post",
			"action" : "/board/delete"
		}).css("display","none"); // cssë¡œ inputì°½ ì•ˆë³´ì´ê²Œ í•˜ê¸°
		// formì— ì„œë²„ë¡œ ë³´ë‚¼ ë°ì´í„° íƒœê·¸ append
		deleteForm.append($("#seq_board")); // ìˆ¨ê²¨ì§„ ë°ì´í„° ì˜ì—­
		// bodyì˜ì—­ì— ì‹¤ì œ html ìš”ì†Œë¡œì¨ form append
		deleteForm.appendTo("body"); // ì‹¤ì œ í˜ì´ì§€ í™”ë©´ì— ë³´ì´ê²Œ í–ˆì§€ë§Œ cssë¡œ ìœ„ì—ì„œ ì•ˆë³´ì´ê²Œ í•¨
		deleteForm.submit(); // form ì œì¶œ
	}
})
</script>
```

- ì‚­ì œ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ë™ì ì¸ form ìƒì„± í›„ controllerì— seq_boardë¥¼ í¬í•¨ì‹œì¼œì„œ ë³´ëƒ„

<span style="color: #2D3748; background-color:#fff5b1;">BoardController</span>


```java
// ê²Œì‹œê¸€ ì‚­ì œ ìš”ì²­
@RequestMapping(value="/delete")
public String delete(int seq_board) throws Exception {
	System.out.println(seq_board);
	int rs = service.delete(seq_board);
	if(rs > 0) System.out.println("ê²Œì‹œê¸€ ì‚­ì œ ì™„ë£Œ");
	else System.out.println("ê²Œì‹œê¸€ ì‚­ì œ ì‹¤íŒ¨");
	return "redirect:/board/toBoard";
}
```
<span style="color: #2D3748; background-color:#fff5b1;">BoardDAO</span>


```java
// ê²Œì‹œê¸€ ì‚­ì œ
public int delete(int seq_board) throws Exception {
	String sql = "delete from board where seq_board = ?";
	try(Connection con = bds.getConnection();
		PreparedStatement pstmt = con.prepareStatement(sql)) {
		pstmt.setInt(1, seq_board);
		return pstmt.executeUpdate();
	}
}
```

<span style="color: #2D3748; background-color:#fff5b1;">BoardService</span>


```java
public int delete(int seq_board) throws Exception {
	return boardDAO.delete(seq_board);
}
```

# 5ï¸âƒ£ ê²Œì‹œê¸€ ìˆ˜ì •

<span style="color: #2D3748; background-color:#fff5b1;">detail.jsp</span>


```html
<form id="modifyForm" action="/board/modify" method="post" enctype="multipart/form-data">
	<div class="container mt-4">
		<!-- ë¡œê·¸ì•„ì›ƒ -->
		<div class="row">
			<div class="col d-flex justify-content-end">
				<button type="button" id="logoutBtn" class="btn btn-danger">ë¡œê·¸ì•„ì›ƒ</button>
			</div>
		</div>
		<!-- head -->
		<div class="row">
			<div class="col text-center">
				<h3>ê¸€ì“°ê¸°</h3>
			</div>
		</div>
		<!--ê¸€ ì“°ê¸° ë‚´ìš©-->
		<div class="mb-3 mt-1">
			<label class="form-label">ì œëª©</label>
			<input type="text" class="form-control" id="title" name="title" value="${map.boardDTO.title}" readonly>
		</div>
		<div class="mb-3 mt-1">
			<label class="form-label">ê¸€ì“´ì´</label>
			<input type="text" class="form-control" id="writer_id" name="writer_id" value="${map.boardDTO.writer_nickname}" readonly>
		</div>
		<!-- íŒŒì¼ ìœ ë¬´ -->
		<div class="mb-3 mt-1">
			<label class="form-label">ì²¨ë¶€íŒŒì¼</label>
			<ul class="list-group">
				<c:if test="${map.fileList.size() == 0}">
					<li class="list-group-item"><b>ì²¨ë¶€ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</b></li>
				</c:if>
				<c:if test="${map.fileList.size() > 0}">
					<c:forEach items="${map.fileList}" var="fileDTO">
						<li class="list-group-item">
							<a href="/file/download?sys_name=${fileDTO.sys_name}&ori_name=${fileDTO.ori_name}">${fileDTO.ori_name}</a>
							<button type="button" class="btn btn-danger d-none deleteFile" value="${fileDTO.sys_name}">-</button>
						</li>
					</c:forEach>
				</c:if>
			</ul>
		</div>
		<!-- ìˆ˜ì • ë²„íŠ¼ ëˆŒë €ì„ ë•Œ íŒŒì¼ ë³´ì´ê²Œ í•˜ê¸° -->
		<div class="col-12 file-col d-none">
			<input type="file" id="" name="files" class="form-control" multiple>
		</div>
		<!-- ë‚´ìš© -->
		<div class="mb-3 mt-1">
			<label class="form-label">ë‚´ìš©</label>
			<textarea class="form-control" style="height: 150px" name="content" id="content"
				readonly>${map.boardDTO.content}</textarea>
		</div>
		<!-- ë’¤ë¡œê°€ê¸°, ìˆ˜ì • ë²„íŠ¼ -->
		<div class="row mt-4">
			<div class="col d-flex justify-content-center">
				<button type="button" id="backBtn" class="btn btn-warning ms-3">ë’¤ë¡œê°€ê¸°</button>
				<!-- ê¸€ì˜ ì‘ì„±ìì™€ í˜„ì¬ ë¡œê·¸ì¸ í•œ ì•„ì´ë””ê°€ ì¼ì¹˜í•  ë•Œë§Œ ìˆ˜ì • ì‚­ì œ ë²„íŠ¼ ë³´ì´ê²Œ -->
				<c:if test="${loginSession.id eq map.boardDTO.writer_id}">
					<button type="button" id="modify" class="btn btn-primary ms-3">ìˆ˜ì •</button>
					<button type="submit" id="complete" class="btn btn-success ms-3 d-none">ì™„ë£Œ</button>
					<button type="button" id="delete" class="btn btn-danger ms-3">ì‚­ì œ</button>
				</c:if>
			</div>
		</div>
	</div>
	<!-- ìˆ¨ê²¨ì§„ ë°ì´í„° ì˜ì—­ -->
	<div class="d-none">
		<input type="text" value="${map.boardDTO.seq_board}" name="seq_board" id="seq_board">
		<input type="text" id="deleteFileList" name="deleteFileList[]">
	</div>
</form>
```


``` javascript
<script>
// ìˆ˜ì • ë²„íŠ¼ í´ë¦­
$("#modify").on("click",function() {
	$("#modify").addClass("d-none"); // ìˆ˜ì • ë²„íŠ¼ ì•ˆë³´ì´ê²Œ
	$("#complete").removeClass("d-none"); // ì™„ë£Œ ë²„íŠ¼ ë³´ì´ê²Œ
	$("#title").attr("readonly",false); // ìˆ˜ì • ê°€ëŠ¥í•˜ê²Œ readonly í’€ì–´ì£¼ê¸°
	$("#content").attr("readonly",false); // ìˆ˜ì • ê°€ëŠ¥í•˜ê²Œ readonly í’€ì–´ì£¼ê¸°
	$(".file-col").removeClass("d-none"); // íŒŒì¼ ì¶”ê°€ í•  ìˆ˜ìˆê²Œ ë³´ì´ê¸°
	$(".deleteFile").removeClass("d-none"); // ìˆ˜ì • ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ë§Œ íŒŒì¼ ì‚­ì œ ë²„íŠ¼ ë³´ì´ê¸°
})
	/* - ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ì‚­ì œí•  íŒŒì¼ì˜ sys_nameì„ ë°°ì—´ì— ê¸°ë¡ / ì €ì¥
		ìˆ˜ì •ì™„ë£Œ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ê·¸ ë°°ì—´ë„ í•¨ê»˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ë„˜ê²¨ì¤Œ
		serviceì˜ modify ë©”ì„œë“œë¥¼ í˜¸ì¶œí–ˆì„ë•Œ ê·¸ ë©”ì„œë“œë¥¼ ë‚´ë¶€ì—ì„œ
		ê²Œì‹œê¸€ ìˆ˜ì • + ìƒˆë¡œ ì²¨ë¶€ëœ íŒŒì¼ ì—…ë¡œë“œ / + ë„˜ê²¨ë°›ì€ ì‚­ì œí•  íŒŒì¼ì˜ ë°°ì—´ì„ ì´ìš©í•´ ì„œë²„ê²½ë¡œì—ì„œ íŒŒì¼ ì‚­ì œ
	*/

// - ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œì˜ value ê°’ ê°€ì ¸ì˜¤ê¸°
$(".deleteFile").on("click", function(e) {
	console.log(e.target.value);

	// ìœ„ì—ì„œ ì„ ì–¸í•œ ë°°ì—´ì— ë°©ê¸ˆ ëˆ„ë¥¸ íŒŒì¼ì˜ ê°’ ë„£ì–´ì£¼ê¸°
	deleteFileList.push(e.target.value);
	console.log(deleteFileList);

	// - ë²„íŠ¼ í´ë¦­ì‹œ í•´ë‹¹ ì¤„ ë‹¤ ì—†ì• ì£¼ê¸° (ê·¸ë˜ì•¼ ì¤‘ë³µí•´ì„œ ì‚­ì œí•˜ëŠ”ê±¸ ë°©ì§€)
	$(this).parent("li").remove(); // í˜„ì¬ ëˆŒë¦° ìš”ì†Œì˜ ë¶€ëª¨ë¥¼ ë‹¤ ì§€ìš´ë‹¤
})

// ìˆ˜ì • ì™„ë£Œ ì´ë²¤íŠ¸ê°€ ì¼ì–´ë‚¬ì„ë•Œ (form ì œì¶œì´ ì¼ì–´ë‚ ë•Œ)
$("#modifyForm").on("submit",function() {
	// ìµœì¢…ì ì¸ íŒŒì¼ ì‚­ì œ ë¦¬ìŠ¤íŠ¸ë¥¼ deleteFileListì— ë‹´ì•„ì£¼ëŠ” ì‘ì—…(inputì—) ë‹´ì•„ì¤Œ
	$("#deleteFileList").val(deleteFileList);
	console.log($("#deleteFileList").val());
	// return false; // form ì œì¶œì„ ë§‰ìŒ
})
</script>
```



### ìš”ì†Œ ë„£ê¸°

```javascript
<button type="button" class="btn btn-danger d-none deleteFile" value="${fileDTO.sys_name}">-</button>
```

- ë²„íŠ¼ì˜ value ê°’ì„ ì„¤ì •í•´ì¤€ë‹¤. â†’ loginSessionê³¼ í˜„ì¬ ì‘ì„±ê¸€ì˜ idê°€ ì¼ì¹˜í•  ë•Œë§Œ ë³´ì´ê²Œ í•œë‹¤
- ìˆ¨ê²¨ì§„ ë°ì´í„° ì˜ì—­ì˜ ê°’ë“¤ì€ controllerë¡œ ë³´ë‚´ì§€ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤.

### ë™ì‘ ìˆœì„œ

1. í˜„ì¬ ì„¸ì…˜ì˜ ì•„ì´ë””ì™€ ê¸€ ì‘ì„±ìì˜ ì•„ì´ë””ê°€ ê°™ë‹¤ë©´ ìˆ˜ì • ë²„íŠ¼ì´ ë³´ì¸ë‹¤.
2. ìˆ˜ì • ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì²¨ë¶€ íŒŒì¼ ìˆ˜ì •, ì‘ì„± ê¸€ì˜ ì œëª©ê³¼ ë‚´ìš© ë³€ê²½ì´ ê°€ëŠ¥í•˜ë‹¤
3. ì²¨ë¶€ íŒŒì¼ ìˆ˜ì • ì‹œ ê¸°ì¡´ì˜ ì²¨ë¶€ íŒŒì¼ëœ ìë£Œë“¤ì„ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ í™œìš©í•´ ë°°ì—´ì— ë„£ì–´ì„œ controllerí•œí…Œ ë³´ë‚´ì¤€ë‹¤(form ì œì¶œì„ í–ˆì„ ë•Œ)
4. ì´ë•Œ ì˜¤ë¥˜ ë°œìƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ controllerì—ì„œ @RequestParam(value="deleteFileList[]")ì„ ì´ìš©í•œë‹¤. (inputì˜ nameë„ deleteFileList[]ì´ì—¬ì•¼ í•œë‹¤)


<span style="color: #2D3748; background-color:#fff5b1;">BoardController.java</span>


```java
// ê²Œì‹œê¸€ ìˆ˜ì •
@RequestMapping(value= "/modify")
public String modify(BoardDTO dto,MultipartFile[] files, @RequestParam(value="deleteFileList[]") String[] deleteFileList) throws Exception {
	// System.out.println("ìˆ˜ì •í˜ì´ì§€ dto : " + dto.toString());
	// System.out.println(files.length);
	// System.out.println(files[0]);

	String path = session.getServletContext().getRealPath("board");
	service.modify(dto, path, files, deleteFileList);

	// toDetail ì—ì„œ seq_boardê°€ í•„ìš”í•´ì„œ
	return "redirect:/board/toDetail?seq_board="+dto.getSeq_board();
}
```
<span style="color: #2D3748; background-color:#fff5b1;">BoardService.java</span>


```java
// ê²Œì‹œê¸€ ìˆ˜ì •
public void modify(BoardDTO dto, String path, MultipartFile[] files, String[] deleteFileList) throws Exception {

	// ìƒˆë¡­ê²Œ ì²¨ë¶€ëœ íŒŒì¼ ì—…ë¡œë“œ + DBì— íŒŒì¼ë°ì´í„° ì €ì¥
	// ë§Œì•½ ì„œë²„ rootì— board í´ë”ê°€ ì—†ìœ¼ë©´ ì¼ë‹¨ board í´ë” ë¨¼ì € ë§Œë“¤ê¸°
	File realPath = new File(path);
	if (!realPath.exists()) { // í´ë” ì¡´ì¬ ìœ ë¬´ í™•ì¸
		realPath.mkdir();
	}

	// files ì•ˆì— ëª‡ê°œì˜ íŒŒì¼ì´ ë“¤ì–´ìˆì„ì§€ ì˜ˆì¸¡í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì—
	// forë¬¸ì„ ëŒë ¤ê°€ë©´ì„œ ë§Œì•½ íŒŒì¼ì´ ë“¤ì–´ìˆë‹¤ë©´ íŒŒì¼ì„ ì—…ë¡œë“œ í›„ DB ì €ì¥
	// System.out.println("files.length : " + files.length);
	for (MultipartFile mf : files) {
		// íŒŒì¼ì´ ë“¤ì–´ìˆë‹¤ë©´
		if (!mf.isEmpty()) {
			String ori_name = mf.getOriginalFilename();
			String sys_name = UUID.randomUUID() + "_" + ori_name;

			mf.transferTo(new File(path + File.separator + sys_name));

			// DBì— íŒŒì¼ ë„£ê¸°
			fileDAO.insert(new FileDTO(0, dto.getSeq_board(), ori_name, sys_name));
		}
	}

	// ìˆ˜ì •ëœ ê²Œì‹œê¸€ ì •ë³´ DBì—ì„œ ìˆ˜ì •í•˜ê¸°
	boardDAO.modify(dto);

	// ì‚­ì œ ìš”ì²­ëœ íŒŒì¼ë“¤ì„ ì„œë²„ ê²½ë¡œì—ì„œ ì‚­ì œ
	// ë„˜ì–´ì˜¨ íŒŒì¼ì´ ìˆë‹¤ë©´
	if(deleteFileList.length != 0) {
		for(String sys_name : deleteFileList) {
			// sys_nameì„ ì´ìš©í•´ full íŒŒì¼ ê²½ë¡œë¥¼ ë§Œë“¤ì–´ì„œ File ê°ì²´ ìƒì„±(ì‹¤ì œë¡œ ì‚­ì œí•˜ê¸° ìœ„í•´) -> delete ë©”ì„œë“œë¡œ íŒŒì¼ ì‚­ì œ
			// Fileì˜ full ê²½ë¡œ
			File file = new File(path + File.separator + sys_name);

			// ì‹¤ì œ ê²½ë¡œì˜ íŒŒì¼ê°’ì´ ì¡´ì¬í•œë‹¤ë©´
			if(file.exists()) {
				file.delete(); // ì‹¤ì œ ì„œë²„ ê²½ë¡œì—ì„œ íŒŒì¼ ì‚­ì œ
				fileDAO.delete(sys_name); // DBì—ì„œ íŒŒì¼ ë°ì´í„° ì‚­ì œ
			}
		}
	}
}
```

### ë™ì‘ ìˆœì„œ

1. ì²« ë²ˆì§¸ ì‘ì—…ì€ ìƒˆë¡œìš´ íŒŒì¼ì´ ë“¤ì–´ì™”ì„ ë•Œ ì„œë²„ì™€ ë°ì´í„°ë² ì´ìŠ¤ì— ê°ê° ì €ì¥
2. ìˆ˜ì •ëœ ê¸€ì˜ ì œëª©ê³¼ ë‚´ìš©ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜
3. ì‚­ì œ ìš”ì²­ëœ íŒŒì¼ì´ ìˆë‹¤ë©´ ì„œë²„ì™€ ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œë„ ì‚­ì œ

<span style="color: #2D3748; background-color:#fff5b1;">BoardDAO</span>


```java
// ê²Œì‹œê¸€ ìˆ˜ì •(ê¸€ ë°ì´í„°)
public void modify(BoardDTO dto) throws Exception {
	String sql = "update board set title=?, content=? where seq_board = ?";

	try(Connection con = bds.getConnection();
		PreparedStatement pstmt = con.prepareStatement(sql)) {

		pstmt.setString(1, dto.getTitle());
		pstmt.setString(2, dto.getContent());
		pstmt.setInt(3, dto.getSeq_board());

		pstmt.executeUpdate();
	}
}
```

- íŒŒì¼ ë°ì´í„°ë¥¼ ì œì™¸í•˜ê³  ê¸€ ì œëª©ê³¼ ë‚´ìš© ìˆ˜ì •

<span style="color: #2D3748; background-color:#fff5b1;">FileDAO</span>


```java
public void delete(String sys_name) throws Exception {
	String sql = "delete from files where sys_name = ?";

	try(Connection con = bds.getConnection();
		PreparedStatement pstmt = con.prepareStatement(sql)) {

		pstmt.setString(1, sys_name);
		pstmt.executeUpdate();
	}
}
```