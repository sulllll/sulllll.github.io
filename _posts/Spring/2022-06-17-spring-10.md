---
layout: single
title:  "DAY-74 Spring ì—ëŸ¬ì²˜ë¦¬, ì–´ë…¸í…Œì´ì…˜, ajax"
categories: Spring
tag: [Spring ì—ëŸ¬ì²˜ë¦¬, ì–´ë…¸í…Œì´ì…˜, ajax]
toc: true
toc_sticky: true
author_profile: false
sidebar:
  nav: "docs"
---

# ğŸ’»2022-06-17

<!--Quote-->
> â— ìˆ˜ì—…ì„ ë“£ê³ , ê°œì¸ì´ ê³µë¶€í•œ ë‚´ìš©ì„ ì ì€ ê²ƒ ì´ê¸°ì— ì˜¤ë¥˜ê°€ ë§ì„ ìˆ˜ë„ ìˆìŒ


# 1ï¸âƒ£ ë²„íŠ¼ì˜ valueë¥¼ ì¤˜ì„œ ì‚­ì œí•˜ê¸°
<span style="color: #2D3748; background-color:#fff5b1;">output.jsp</span>


```javascript
<tr>
	<td>${dto.no}</td>
	<td>${dto.nickname}</td>
	<td>${dto.message}</td>
	<td><button type="button" class="modifyBtn">ìˆ˜ì •</button></td>
	<td><button type="button" class="deleteBtn" value="${dto.no}">ì‚­ì œ</button></td>
</tr>

// ì‚­ì œ ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œ confirm ì°½ì„ ë„ì›Œì¤Œ -> ì§„ì§œ ì‚­ì œí•˜ê² ë‹¤ë¼ê³  í•˜ë©´ ê·¸ ë•Œì˜ seq ë²ˆí˜¸ë¥¼ ì„œë²„ì— ì „ì†¡í•´ì„œ ì‚­ì œ
let deleteBtn = document.getElementsByClassName("deleteBtn");
for(i = 0; i < deleteBtn.length; i++) {
	deleteBtn[i].addEventListener("click",function(e) {
		let answer = confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
		console.log(answer);
		if(answer) {
			console.log(this.value); // ëˆŒë¦° buttonì˜ valueë¥¼ ì¶œë ¥ ê°€ëŠ¥í•˜ë‹¤
			console.log(e.target.value); // í˜¹ì€ e.targetì„ ì´ìš©í•œë‹¤
			// let val1 = e.target.value; ì•„ë˜ì˜ ì½”ë“œì™€ ê°™ë‹¤
			let val2 = this.value;
			location.href = "/delete?no="+val2; // noì´ë¼ëŠ” key ê°’ìœ¼ë¡œ ë³´ëƒ„
		}
	});
}
```

- ë²„íŠ¼ì— valueë¥¼ ì¤˜ì„œ í´ë¦­ ì‹œ í•´ë‹¹ ê¸€ì˜ seq_noë¥¼ ì•Œ ìˆ˜ ìˆê²Œí•œë‹¤ â†’ value="${dto.no}"
- í˜„ì¬ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ê·¸ ë²„íŠ¼ì˜ valueë¥¼ ì•„ëŠ” ë°©ë²•ì€ [e.target](http://e.target).value í˜¹ì€ this.valueë¥¼ ì´ìš©í•œë‹¤.

<span style="color: #2D3748; background-color:#fff5b1;">HomeController.java</span>

```java
// ë°ì´í„° ì‚­ì œ
@RequestMapping(value = "/delete")
public String delete(int no) {  // output.jspì—ì„œ noìœ¼ë¡œ í‚¤ ê°’ì„ ë³´ë‚´ê³  ìˆë‹¤.location.href = "/delete?no="+val2;
	try {
		int rs = dao.delete(no);
		if(rs > 0) {
			System.out.println("ì‚­ì œ ì„±ê³µ");
		}
	} catch (Exception e) {
		e.printStackTrace();
		return "redirect:/toError";
	}
	return "redirect:/toOutput";
}
```

- delete í•¨ìˆ˜ì˜ ì¸ìì˜ ë³€ìˆ˜ëª…ê³¼ output.jspì—ì„œ ë„˜ê²¨ì£¼ëŠ” í‚¤ ê°’(no)ì´ ê°™ì•„ì•¼ í•œë‹¤(inputê³¼ ê°™ì€ ê²½ìš° inputì˜ nameê³¼ ì¼ì¹˜í•´ì•¼í•¨)

# 2ï¸âƒ£ inputì„ ìˆ¨ê²¨ë†“ê³  value ê°’ ì „ì†¡
<span style="color: #2D3748; background-color:#fff5b1;">HomeController.java</span>

```java
// ë°ì´í„° ìˆ˜ì •
@RequestMapping(value ="/toModify") // ìˆ˜ì • ë²„íŠ¼ í´ë¦­ì‹œ ë“¤ì–´ì˜¤ëŠ” í˜ì´ì§€
public String toModify(int no, Model model) {
	System.out.println("ìˆ˜ì •í•  noëŠ” : " + no);

try {
	MessageDTO dto = dao.selectByNo(no); // ê°’ì„ ë°›ì•„ì˜´
	model.addAttribute("dto", dto);
}catch(Exception e) {
	e.printStackTrace();
	return "redirect:/toError";
}
return "modify"; // modifyë¡œ í•´ë‹¹ noì„ ì´ìš©í•´ ê°’ì„ ë½‘ì•„ì˜¨ ë°ì´í„°ë¥¼ ë³´ëƒ„
}
```
<span style="color: #2D3748; background-color:#fff5b1;">Modify.jsp</span>


```java
<!-- /toModifyì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´ -->
<form method="post" action="">
	<input type="text" name="no" value="${dto.no}" hidden>
	<label>nickname : </label>
	<input type="text" name="nickname" value="${dto.nickname}">
	<label>message : </label>
	<input type="text" name ="message" value="${dto.message}">
	<button type="submit">ì „ì†¡</button>
</form>
```

- í•´ë‹¹ ê¸€ ë²ˆí˜¸ë¥¼ ì „ì†¡ì‹œí‚¤ê¸° ìœ„í•´ì„œ ì•ˆë³´ì´ëŠ” inputì„ ë§Œë“¤ì–´ì¤€ë‹¤

# 3ï¸âƒ£ ì—ëŸ¬ ì²˜ë¦¬

## @ExceptionHandler

- controller ë‚´ë¶€ì— ìˆìœ¼ë©´ ì˜ˆì™¸ê°€ ë°œìƒí–ˆì„ í•´ë‹¹ ë©”ì„œë“œë¥¼ ìë™ ì‹¤í–‰

<span style="color: #2D3748; background-color:#fff5b1;">MessageDAO</span>

```java
public int update(MessageDTO dto) throws Exception {
	String sql = "update msg set nickname=? , message=? where no = ?";

	try(Connection con = bds.getConnection();
		PreparedStatement pstmt = con.prepareStatement(sql)) {

		pstmt.setString(1, dto.getNickname());
		pstmt.setString(2, dto.getMessage());
		pstmt.setInt(3, dto.getNo());

		int rs = pstmt.executeUpdate();
		return rs;
	}
}
```

- controllerì—ê²Œ ì—ëŸ¬ë¥¼ throw í•˜ê³  ìˆë‹¤.


<span style="color: #2D3748; background-color:#fff5b1;">HomeController.java</span>


```java
// modify.jspì—ì„œ ì „ì†¡ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ë“¤ì–´ì˜¤ëŠ” Controller
@RequestMapping(value ="/modify")
// public String modify(int no, String nickname, String message) -> ë°›ëŠ” ì¸ìê°€ ì ì„ ë•Œ
public String modify(MessageDTO dto) throws Exception{ // -> ë°›ëŠ” ì¸ìê°€ ë§ì„ ë•ŒëŠ” command ê°ì²´ ì´ìš©
	System.out.println(dto.toString());
	int rs = dao.update(dto);
	if (rs > 0) {
		System.out.println("ìˆ˜ì • ì™„ë£Œ");
	}
	return "redirect:/toOutput";
}

@ExceptionHandler // @ExceptionHandlerì´ ë¶™ì€ ë©”ì„œë“œê°€ controller ë‚´ë¶€ì— ìˆìœ¼ë©´ ì˜ˆì™¸ê°€ ë°œìƒí–ˆì„ í•´ë‹¹ ë©”ì„œë“œë¥¼ ìë™ ì‹¤í–‰
public String handleError(Exception e) {
	System.out.println("ì—ëŸ¬ ë°œìƒ");
	e.printStackTrace();
	return "redirect:/toError";
}

// @ExceptionHandler(ì²˜ë¦¬í•´ì£¼ê³  ì‹¶ì€ ì˜ˆì™¸ëª…ì„ ëª…ì‹œ)
@ExceptionHandler(NullPointerException.class) // NullPoniter ì—ëŸ¬ë§Œ ì²˜ë¦¬
public String handleNull(Exception e) {
	System.out.println("ë„í¬ì¸íŠ¸ ìµì„¼ì…¥ ë°œìƒ");
	e.printStackTrace();
	return "error2";
}
```

- ê¸°ì¡´ : DAOì—ì„œ throws í•´ì¤€ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ ë©”ì„œë“œ ë‚´ì˜ try catchë¬¸ì„ ì´ìš©í–ˆë‹¤.
- ìƒˆë¡œìš´ ë°©ë²• : ë©”ì„œë“œ ë‚´ì˜ try catchì—†ì• ê³  ë‹¤ì‹œ í•œë²ˆ throws Exceptionì„ í•´ì¤€ë‹¤ â†’ ExceptionHandler ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì–´ ìˆëŠ” ë©”ì„œë“œê°€ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•œë‹¤.
- íŠ¹ì •í•œ ì—ëŸ¬ë§Œ ì²˜ë¦¬í•˜ë ¤ë©´ @ExceptionHandler(ì²˜ë¦¬í•´ì£¼ê³  ì‹¶ì€ ì˜ˆì™¸ëª…ì„ ëª…ì‹œ)ë¥¼ ì‚¬ìš©í•œë‹¤


# 4ï¸âƒ£ í•œê¸€ ì¸ì½”ë”© í•„í„° ì„¤ì •

- web.xmlì—ì„œ filterë¡œ ì„¤ì •

```java
<!-- í•œê¸€ ì¸ì½”ë”© í•„í„° ì„¤ì •  -->
	<filter>
		<filter-name>characterEncoding</filter-name>
		<filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>
		<init-param>
			<param-name>encoding</param-name>
			<param-value>UTF-8</param-value>
		</init-param>
	</filter>
	<filter-mapping>
		<filter-name>characterEncoding</filter-name>
		<url-pattern>/*</url-pattern>
	</filter-mapping>
```



# 5ï¸âƒ£ ajaxë¡œ ê°’ ì „ì†¡ ë° ê°’ ë°›ê¸°
**@ResponseBody ì´ìš©**

1. ajax ìš”ì²­ ê°’ì— ëŒ€í•œ ë°˜í™˜
2. ResponseBody ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•˜ë©´ ë°˜í™˜ ê°’ì´ ViewResolverí•œí…Œ ê°€ì§€ ì•Šê³  controller ë©”ì„œë“œë¥¼ ìš”ì²­í•œ jspìª½ ajaxìª½ìœ¼ë¡œ ê·¸ëŒ€ë¡œ ë°˜í™˜ ê°’ì´ ëŒì•„ê°„ë‹¤. (ì¦‰ A.jsp ì—ì„œ controllerë¡œ ajax ìš”ì²­ì‹œ , controllerì˜ ë©”ì„œë“œì—ì„œ return ê°’ì„ A.jspì˜ dataë¡œ ëŒë ¤ì¤€ë‹¤)

```
ë³´í†µì€ @Controller ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•˜ì—¬Controllerë¥¼ ìƒì„±í–ˆì„ë•Œ,
(ViewResolverì— ì˜í•´) return ê°’ìœ¼ë¡œ ë°˜í™˜í•˜ëŠ” ë¬¸ìì—´ ì´ë¦„ì˜ view í˜ì´ì§€ë¥¼ ë„ì–´ì¤€ë‹¤.
ë§Œì•½, View í˜ì´ì§€ê°€ ì•„ë‹Œ ë°˜í™˜ê°’ ê·¸ëŒ€ë¡œ í´ë¼ì´ì–¸íŠ¸í•œí…Œ return í•˜ê³  ì‹¶ì€ ê²½ìš° @ResponseBodyë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```

- ì¶œì²˜ : [https://memostack.tistory.com/243](https://memostack.tistory.com/243)


<span style="color: #2D3748; background-color:#fff5b1;">HomeController.java</span>

```java
// ajaxë¡œ ë°ì´í„° ì‚­ì œ
// ajax ìš”ì²­ê°’ì— ëŒ€í•œ ë°˜í™˜ -> annotation(@ResponseBody)
@ResponseBody
@RequestMapping(value = "/deleteAjax")
public String deleteAjax(int no) throws Exception {
	int rs = dao.delete(no);
	if (rs > 0) {
		System.out.println("deleteAjax ì‚­ì œ ì„±ê³µ");
	}
	return "success"; // returnê°’ì´ ajaxë¥¼ ìš”ì²­í•œ í˜ì´ì§€ë¡œ ë‹¤ì‹œ ëŒì•„ê°
}
```
<span style="color: #2D3748; background-color:#fff5b1;">output2.jsp(ajaxì´ìš© í˜ì´ì§€)</span>

```javascript

<tr>
	<td>${dto.no}</td>
	<td>${dto.nickname}</td>
	<td>${dto.message}</td>
	<td><button type="button" class="modifyBtn" value="${dto.no}">ìˆ˜ì •</button></td>
	<td><button type="button" class="deleteBtn" value="${dto.no}">ì‚­ì œ</button></td>
</tr>

// ì‚­ì œ ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œ confirm ì°½ì„ ë„ì›Œì¤Œ -> ì§„ì§œ ì‚­ì œí•˜ê² ë‹¤ë¼ê³  í•˜ë©´ ê·¸ ë•Œì˜ seq ë²ˆí˜¸ë¥¼ ì„œë²„ì— ì „ì†¡í•´ì„œ ì‚­ì œ
let deleteBtn = document.getElementsByClassName("deleteBtn");
for(i = 0; i < deleteBtn.length; i++) {
	deleteBtn[i].addEventListener("click",function() {
		let answer = confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
		console.log(answer);
		if(answer) {
			let val = this.value;
			$.ajax({
				url : "/deleteAjax",
				type : "post",
				data : {no : val},
				success : function(data) { // HomeControllerì—ì„œ returnìœ¼ë¡œ ë³´ë‚¸ê°’ì´ dataë¡œ ë„˜ì–´ì˜´
					console.log(data); // HomeControllerì—ì„œ ë³´ë‚¸ success ì¶œë ¥
				},
				error : function(e) {
					console.log(e);
			}
	})
			}
	});
}
```